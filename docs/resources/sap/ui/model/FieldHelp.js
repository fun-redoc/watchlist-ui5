/*!
 * OpenUI5
 * (c) Copyright 2009-2024 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/Log","sap/ui/core/Element","sap/ui/core/ElementRegistry","sap/ui/core/LabelEnablement"],function(e,t,o,s){"use strict";const i="sap/ui/model/FieldHelp";const n="com.sap.vocabularies.Common.v1.DocumentationRef";const l="urn:sap-com:documentation:key?=";let a;class r{#e=false;#t=null;#o={};#s=null;static _requestDocumentationRef(t){if(t.isDestroyed()){return undefined}const o=t.getResolvedPath();if(!o||o.includes("#")||o.includes("@")){return undefined}const s=t.getModel()?.getMetaModel();if(!s||!s.getMetaContext){return undefined}let l;if(s.isA("sap.ui.model.odata.ODataMetaModel")){l=s.loaded().then(()=>s.getObject("",s.getMetaContext(o))?.[n])}else{l=s.requestObject("@"+n,s.getMetaContext(o))}return l.then(e=>e?.String).catch(t=>{e.error(`Failed to request '${n}' annotation for path '${o}'`,t,i);return undefined})}_getFieldHelpHotspots(){const o=[];Object.keys(this.#o).forEach(n=>{const a=t.getElementById(n);if(!a){delete this.#o[n];return}const r=s._getLabelTexts(a)[0];if(!r){e.error(`Cannot find a label for control '${n}'; ignoring field help`,JSON.stringify(this.#o[n]),i);return}const c=new Set;Object.values(this.#o[n]).forEach(e=>{e.forEach(c.add.bind(c))});Array.from(c).forEach(e=>{const t=new URLSearchParams(e.slice(l.length));o.push({backendHelpKey:{id:t.get("id"),origin:t.get("origin"),type:t.get("type")},hotspotId:n,labelText:r})})});return o}_setFieldHelpDocumentationRefs(e,t,o){const s=e.getId();this.#o[s]||={};if(o.length>0){this.#o[s][t]=o}else{delete this.#o[s][t];if(Object.keys(this.#o[s]).length===0){delete this.#o[s]}}this._updateHotspots().catch(()=>{})}_updateHotspots(){if(this.#s){return this.#s}let e,t;this.#s=new Promise((o,s)=>{e=o;t=s});setTimeout(()=>{if(this.isActive()){this.#t(this._getFieldHelpHotspots());e()}else{t()}this.#s=null},0);return this.#s}static getInstance(){a||=new r;return a}activate(e){if(this.#e){if(this.#t!==e){throw new Error("The field help is active for a different update hotspots callback handler")}return}this.#e=true;this.#t=e;o.forEach(e=>{const t=e.data("sap-ui-DocumentationRef");if(t){this._setFieldHelpDocumentationRefs(e,undefined,Array.isArray(t)?t:[t])}else{Object.keys(e.getMetadata().getAllProperties()).forEach(t=>{this.update(e,t)})}})}deactivate(){this.#e=false;this.#o={};this.#t=null}isActive(){return this.#e}update(e,t){if(!this.#e||e.getMetadata().getProperty(t)?.group!=="Data"){return}const o=e.getBinding(t);if(!o){return}let s;if(o.isA("sap.ui.model.CompositeBinding")){const e=o.getType()?.getPartsIgnoringMessages()||[];s=o.getBindings().filter((t,o)=>!e.includes(o))}else{s=[o]}Promise.all(s.map(e=>r._requestDocumentationRef(e))).then(o=>{o=o.filter(e=>e);this._setFieldHelpDocumentationRefs(e,t,o)})}}return r});
//# sourceMappingURL=FieldHelp.js.map