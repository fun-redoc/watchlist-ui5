/*!
 * OpenUI5
 * (c) Copyright 2009-2024 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["../library","sap/base/i18n/Localization","sap/ui/Device","sap/ui/core/Element","sap/ui/core/StaticArea","../UIArea","sap/ui/thirdparty/jquery"],function(e,t,r,n,i,o,jQuery){"use strict";var a=e.dnd.RelativeDropPosition;var f={},s=null,g=null,u=null,l=[],d=[],c=null,p,D,h,v,m={},w,b,C;function E(e,t){if(!e){return}if(e.addStyleClass){e.addStyleClass(t)}else{e.$().addClass(t)}}function y(e,t){if(!e){return}if(e.removeStyleClass){e.removeStyleClass(t)}else{e.$().removeClass(t)}}function S(e,t){var r=n.closestTo(e.target,true);if(!r){return}var i=jQuery.Event(null,e);i.type=t;r.getUIArea()._handleEvent(i)}function A(e){return!e.disabled&&/^(input|textarea)$/.test(e.localName)}function O(e,t){if(!e||!e.getDragGhost){return}var r=e.getDragGhost();if(!r){return}if(!D){D=jQuery('<div class="sapUiDnDGhostContainer"></div>');jQuery(document.body).append(D)}D.append(r);window.setTimeout(function(){D.empty()},0);var n=t.originalEvent;n.dataTransfer.setDragImage(r,n.offsetX,n.offsetY)}function T(e){var t={},r,n=e.originalEvent.dataTransfer,i=function(e,t){n.setData(e,t)};return{setData:function(e,r){r=""+r;t[e]=r;i(e,r)},getData:function(e){return t[e]},setTextData:function(e){e=""+e;t["text/plain"]=e;t["text"]=e;i("text/plain",e);i("text",e)},getTextData:function(){return t["text/plain"]},setComplexData:function(e,r){t[e]=r},getComplexData:function(e){return t[e]},getIndicator:function(){return p&&p[0]},setIndicatorConfig:function(e){r=e},getIndicatorConfig:function(e){return r},getDragControl:function(){return s},getDropControl:function(){return u},setDropControl:function(e){u=e},getDropInfo:function(){return d[0]||null},getDropPosition:function(){return h}}}function x(e){s=g=u=c=null;h="";C=false;l=[];d=[]}function I(){if(p){return p}p=jQuery("<div class='sapUiDnDIndicator'></div>");jQuery(i.getDomRef()).append(p);return p}function B(){if(p){p.removeAttr("style");p.hide();m={}}}function N(e,r,n,i,o){if(!r){return}var f=u.getDropAreaRect?u.getDropAreaRect(i):r.getBoundingClientRect(),s=e.dragSession&&e.dragSession.getIndicatorConfig(),g=window.pageYOffset,l=window.pageXOffset,d=I(),c,p={},D={top:f.top+g,bottom:f.bottom+g,left:f.left+l,right:f.right+l,width:f.width,height:f.height};if(!n||n=="On"){c=a.On;i=""}else if(i=="Horizontal"){var h=e.pageX-D.left;p.height=D.height;p.top=D.top;if(n=="Between"){p.width="";if(h<D.width*.5){c=a.Before;p.left=D.left}else{c=a.After;p.left=D.right}}else if(n=="OnOrBetween"){if(h<D.width*.25){c=a.Before;p.left=D.left;p.width=""}else if(h>D.width*.75){c=a.After;p.left=D.right;p.width=""}else{c=a.On}}if(c!=a.On&&t.getRTL()){c=c==a.After?a.Before:a.After}}else{var v=e.pageY-D.top;p.width=D.width;p.left=D.left;if(n=="Between"){p.height="";if(v<D.height*.5){c=a.Before;p.top=D.top}else{c=a.After;p.top=D.bottom}}else if(n=="OnOrBetween"){if(v<D.height*.25){c=a.Before;p.top=D.top;p.height=""}else if(v>D.height*.75){c=a.After;p.top=D.bottom;p.height=""}else{c=a.On}}}if(o||s?.display=="none"){return c}if(c==a.On){p.top=D.top;p.left=D.left;p.width=D.width;p.height=D.height;n=c}else{n="Between"}if(m.top!=p.top||m.left!=p.left||m.width!=p.width||m.height!=p.height){d.attr("data-drop-layout",i);d.attr("data-drop-position",n);d.css(Object.assign(p,s));d.show();m=p}return c}function R(e){var t=e.getParent(),r=e.getDragDropConfig?e.getDragDropConfig():[],n=t&&t.getDragDropConfig?t.getDragDropConfig():[];return r.concat(n)}function k(e){var t=R(e);return t.filter(function(t){return t.isDraggable(e)})}function U(e,t,r){var n=R(e);t=t||[];return n.filter(function(e){return!e.isA("sap.ui.core.dnd.IDragInfo")}).concat(t).filter(function(n){if(!n.isDroppable(e,r)){return false}var i=n.getGroupName();if(!i){return true}return t.some(function(e){return e.getGroupName()==i})})}function P(e,t){e.preventDefault();if(s){var r=t.getDropEffect().toLowerCase();e.originalEvent.dataTransfer.dropEffect=r}}function M(e,t,r,n){var i=t.getTargetAggregation();if(!i){return N(e,r.getDomRef(),undefined,undefined,n)}var o;if(e.getMark("DragWithin")==i){o=r.getDomRefForSetting(i)}o=o||r.getDomRef();return N(e,o,t.getDropPosition(true),t.getDropLayout(true),n)}f.preprocessEvent=function(e){if(c&&e.type.indexOf("dr")==0){e.dragSession=c}var t="onbefore"+e.type;if(f[t]){f[t](e)}};f.postprocessEvent=function(e){var t="onafter"+e.type;if(f[t]){f[t](e)}};f.onbeforemousedown=function(e){if(r.browser.firefox&&A(e.target)){w=jQuery(e.target).closest("[data-sap-ui-draggable=true]").prop("draggable",false)[0]}};f.onbeforemouseup=function(e){if(w){w.draggable=true;w=null}};f.onbeforedragstart=function(e){if(!e.target.draggable){return}if(A(document.activeElement)){e.target.getAttribute("data-sap-ui-draggable")&&e.preventDefault();return}s=n.closestTo(e.target,true);if(!s){return}l=k(s);if(!l.length){return}if(!r.system.desktop&&!e.originalEvent.dataTransfer.getData("text")){e.originalEvent.dataTransfer.setData("text"," ")}e.dragSession=c=T(e)};f.onafterdragstart=function(e){if(!l.length||e.isDefaultPrevented()){x();return}l=e.isMarked("NonDraggable")?[]:l.filter(function(t){return t.fireDragStart(e)});if(!l.length){e.preventDefault();x();return}O(s,e);E(s,"sapUiDnDDragging");if(jQuery(e.target).closest(".sapUiScrollDelegate")[0]){jQuery("html").addClass("sapUiDnDNoScrolling")}};f.onbeforedragenter=function(e){var t=n.closestTo(e.target,true);if(t&&g===t){e.setMark("DragWithin","SameControl")}else{v=Date.now();g=t}var r=[],i;u=t;for(var o=0;o<20&&u;o++){r=U(u,l,e);if(r.length){break}i=u.getDomRef();i=i&&i.parentElement;u=n.closestTo(i,true)}if(e.getMark("DragWithin")!="SameControl"){d=r;if(c){c.setIndicatorConfig(null)}}if(!d.length){u=null}else if(!c){C=true;e.dragSession=c=T(e)}};f.onafterdragenter=function(e){if(!u||e.isMarked("NonDroppable")){d=[]}else if(e.getMark("DragWithin")!="SameControl"){d=d.filter(function(t){h=M(e,t,u,true);return t.fireDragEnter(e)})}var t=d[0];if(!t||t.getDropEffect()=="None"){B();h=""}else{P(e,t);h=M(e,t,u)}};f.onbeforedragover=function(e){var t=Date.now();if(t-v>=1e3){S(e,"longdragover");v=t}};f.onafterdragover=function(e){if(!u||e.isMarked("NonDroppable")){d=[]}else{d=d.filter(function(t){h=M(e,t,u,true);return t.fireDragOver(e)})}const t=d[0];if(!t||t.getDropEffect()=="None"){B();h=""}else{P(e,t);if(t&&t.getDropPosition(true)=="On"){return}h=M(e,t,u)}};f.onafterdragleave=function(e){if(C&&!e.relatedTarget){B();x()}};f.onbeforedrop=function(e){if(d.length){e.preventDefault()}};f.onafterdrop=function(e){d.forEach(function(t){t.fireDrop(e)});b=requestAnimationFrame(this.onafterdragend.bind(this,e))};f.onafterdragend=function(e){b=cancelAnimationFrame(b);l.forEach(function(t){t.fireDragEnd(e)});y(s,"sapUiDnDDragging");jQuery("html").removeClass("sapUiDnDNoScrolling");B();x()};o.addEventPreprocessor(f.preprocessEvent);o.addEventPostprocessor(f.postprocessEvent);return f},true);
//# sourceMappingURL=DragAndDrop.js.map