{"version":3,"file":"Component.js","names":["mkDBManager","___services_DBManager","MOWatchStock","_interopRequireDefault","__MOWatchStock","api_getAssetBatch","___services_yFinApiService","useCache","__useCache","DB_NAME_WATCHLIST","DB_STORE_WATCHLIST","DB_VERSION_WATCHLIST","AppComponent","UIComponent","extend","constructor","prototype","apply","arguments","yFinPool","Promise","resolve","metadata","manifest","aggregations","watchlist","type","singularName","multiple","bindable","properties","deviceType","defaultValue","visibility","deviceIsNotTouch","deviceIsTouch","apiKey","cacheInterval","defaultAggregation","getI18nResourceBundle","_getI18nResourceBundle","i18nResourceBundle","i18nModel","getModel","getResourceBundle","init","_init","UIComponent.prototype.init.call","setModel","ManagedObjectModel","setDefaultBindingMode","model","setProperty","Device","media","getCurrentRange","name","support","touch","getRouter","initialize","loadSettings","loadWatchlistFromIndexDB","destroy","_destroy","bSuppressInvalidate","console","log","onDeactivate","_onDeactivate","onActivate","_onActivate","saveSettings","_saveSettings","setTimeout","localStorage","setItem","API_KEY_STORAGE_ID","USE_CACHE_STORAGE_ID","CACHE_INTERVAL_STORAGE_ID","_loadSettings","getItem","useCacheString","cacheIntervalString","Number","parseInt","getWatchDBM","_getWatchDBM","dbm","_loadWatchlistFromIndexDB","destroyAggregation","me","indexName","isUnique","then","list","map","e","mo","symbol","setAggregation","watchSince","addAggregation","refresh","isAlreadyWatched","_isAlreadyWatched","watch","xs","getAggregation","find","x","getProperty","undefined","addToWatch","_addToWatch","dbManager","_","add","err","error","reject","addToYFinPool","_addToYFinPool","filter","newYFP","yfp","forEach","s","push","refreshYFinPool","getYFinPool","_getYFinPool","_refreshYFinPool","symbolsToFetch","Object","keys","filters","values","reduce","acc","o","yFinQuoteResults","fetchFromYFin","newYfp","r","_fetchFromYFin","doUseCache","fetchBatchApi","fetchBatchApiFn","fetchBatch","fetchBatchApiFnCached","timeOutMillis","result","start","length","bachEnd","Math","min","MAX_BATCH_SIZE","batch","slice","quoteResults","concat","refreshWatchlistMarketData","_refreshWatchlistMarketData","watched","getWatchlist","symbolsToMO","quotes","quote","updateFromQuote","warn","_updateFromQuote","propertyMap","getMetadata","getAllProperties","propertyNames","anyQuote","_getWatchlist"],"sources":["Component.ts"],"sourcesContent":["import UIComponent from \"sap/ui/core/UIComponent\";\nimport { DBManager, mkDBManager } from \"./services/DBManager\";\nimport WatchStock from \"./types/Watch\";\nimport ManagedObject from \"sap/ui/base/ManagedObject\";\nimport ManagedObjectModel from \"sap/ui/model/base/ManagedObjectModel\";\nimport { MetadataOptions as ComponentMetadataOptions } from \"sap/ui/core/Component\";\nimport MOWatchStock from \"./managedobject/MOWatchStock\";\nimport ResourceBundle from \"sap/base/i18n/ResourceBundle\";\nimport ResourceModel from \"sap/ui/model/resource/ResourceModel\";\nimport { api_getAssetBatch } from \"./services/yFinApiService\";\nimport useCache from \"./services/cacheService\";\nimport { YFinQuoteResult } from \"./types/yFinApiTypes\";\nimport Device from \"sap/ui/Device\";\n\nexport const DB_NAME_WATCHLIST = \"watchlistUI5DB\";\nexport const DB_STORE_WATCHLIST = \"watchlistUI5Store\";\nexport const DB_VERSION_WATCHLIST = 2;\n\ntype Symbol = string;\ntype YFinPoolFilter = \"watch\" | \"wealth\";\ninterface YFinPoolEntry extends YFinQuoteResult {\n  filter: YFinPoolFilter[];\n}\n\n/**\n * @namespace rsh.watchlist.ui5\n */\nexport default class AppComponent extends UIComponent {\n  static API_KEY_STORAGE_ID = \"apiKeyInput\";\n  static USE_CACHE_STORAGE_ID = \"useCache\";\n  static CACHE_INTERVAL_STORAGE_ID = \"cacheInterval\";\n\n  public static readonly metadata: ComponentMetadataOptions = {\n    manifest: \"json\",\n    aggregations: {\n      watchlist: {\n        type: \"rsh.watchlist.ui5.managedobject.MOWatchStock\",\n        singularName: \"watchstock\",\n        multiple: true,\n        bindable: true,\n      },\n    },\n    properties: {\n      deviceType: {\n        type: \"string\",\n        bindable: true,\n        defaultValue: \"Phone\",\n        visibility: \"public\",\n      },\n      deviceIsNotTouch: {\n        type: \"boolean\",\n        bindable: true,\n        defaultValue: false,\n        visibility: \"public\",\n      },\n      deviceIsTouch: {\n        type: \"boolean\",\n        bindable: true,\n        defaultValue: false,\n        visibility: \"public\",\n      },\n      apiKey: {\n        type: \"string\",\n        bindable: true,\n        defaultValue: \"\",\n        visibility: \"public\",\n      },\n      useCache: {\n        type: \"boolean\",\n        bindable: true,\n        defaultValue: false,\n        visibility: \"public\",\n      },\n      cacheInterval: {\n        type: \"sap.ui.model.type.Integer\",\n        bindable: true,\n        defaultValue: 15,\n        visibility: \"public\",\n      },\n    },\n    defaultAggregation: \"watchlist\",\n  };\n  private dbm: Promise<DBManager<WatchStock>>;\n  private i18nResourceBundle: Promise<ResourceBundle> | ResourceBundle;\n  private yFinPool: Promise<Record<Symbol, YFinPoolEntry>> = new Promise(\n    (resolve) => resolve({})\n  );\n\n  protected async getI18nResourceBundle(): Promise<ResourceBundle | undefined> {\n    if (this.i18nResourceBundle) return this.i18nResourceBundle;\n    const i18nModel = this.getModel(\"i18n\") as ResourceModel;\n    this.i18nResourceBundle = i18nModel.getResourceBundle();\n    return this.i18nResourceBundle;\n  }\n\n  public init() {\n    super.init();\n    this.setModel(new ManagedObjectModel(this), \"component\");\n    this.getModel(\"component\")?.setDefaultBindingMode(\"TwoWay\");\n\n    const model = this.getModel(\"component\") as ManagedObjectModel;\n    model.setProperty(\"/deviceType\", Device.media.getCurrentRange(\"Std\").name);\n    model.setProperty(\"/deviceIsTouch\", Device.support.touch);\n    model.setProperty(\"/deviceIsNotTouch\", !Device.support.touch);\n\n    // create the views based on the url/hash\n    this.getRouter().initialize();\n    this.loadSettings();\n\n    this.loadWatchlistFromIndexDB();\n  }\n  public destroy(bSuppressInvalidate?: boolean | undefined): void {\n    console.log(\"AppComonent destroy\");\n  }\n  public onDeactivate(): void {\n    console.log(\"AppComonent onDeactivate\");\n  }\n  public onActivate(): void {\n    console.log(\"AppComonent onActivate\");\n  }\n  public saveSettings(\n    apiKey: string,\n    useCache: boolean,\n    cacheInterval?: number\n  ) {\n    const model = this.getModel(\"component\") as ManagedObjectModel;\n    model.setProperty(\"/apiKey\", apiKey);\n    model.setProperty(\"/useCache\", useCache);\n    if (cacheInterval) {\n      model.setProperty(\"/cacheInterval\", cacheInterval);\n    }\n    setTimeout(() => {\n      localStorage.setItem(AppComponent.API_KEY_STORAGE_ID, apiKey);\n      localStorage.setItem(AppComponent.USE_CACHE_STORAGE_ID, `${useCache}`);\n      if (cacheInterval) {\n        localStorage.setItem(\n          AppComponent.CACHE_INTERVAL_STORAGE_ID,\n          `${cacheInterval}`\n        );\n      }\n    });\n  }\n  private loadSettings() {\n    const apiKey = localStorage.getItem(AppComponent.API_KEY_STORAGE_ID);\n    const useCacheString = localStorage.getItem(\n      AppComponent.USE_CACHE_STORAGE_ID\n    );\n    const useCache = useCacheString === \"true\";\n    const cacheIntervalString = localStorage.getItem(\n      AppComponent.CACHE_INTERVAL_STORAGE_ID\n    );\n    const cacheInterval = Number.parseInt(cacheIntervalString);\n    const model = this.getModel(\"component\") as ManagedObjectModel;\n    model.setProperty(\"/apiKey\", apiKey);\n    model.setProperty(\"/useCache\", useCache);\n    if (cacheInterval) {\n      // otherwiese take default\n      model.setProperty(\"/cacheInterval\", cacheInterval);\n    }\n  }\n  public async getWatchDBM(): Promise<DBManager<WatchStock>> {\n    return await this.dbm;\n  }\n  private async loadWatchlistFromIndexDB(): Promise<void> {\n    // connect to Browsers IndexDb for Watchlist\n    this.destroyAggregation(\"component\", true);\n    const me = this;\n    this.dbm = mkDBManager<WatchStock>(\n      DB_NAME_WATCHLIST,\n      DB_STORE_WATCHLIST,\n      DB_VERSION_WATCHLIST,\n      [{ indexName: \"symbol\", isUnique: true }]\n    );\n    this.dbm\n      .then((dbm) => dbm.list())\n      .then((list) => {\n        list.map((e) => {\n          const mo = new MOWatchStock();\n          mo.setProperty(\"symbol\", e.symbol);\n          mo.setProperty(\"name\", e.name);\n          mo.setAggregation(\"watchSince\", e.watchSince);\n          me.addAggregation(\"watchlist\", mo);\n        });\n        //this.getModel(\"component\")?.refresh()\n      });\n    this.getModel(\"component\")?.refresh();\n  }\n  private isAlreadyWatched(watch: WatchStock): boolean {\n    const xs = (this.getAggregation(\"watchlist\") || []) as ManagedObject[];\n    return (\n      xs.find((x) => x.getProperty(\"symbol\") === watch.symbol) !== undefined\n    );\n  }\n  public async addToWatch(watch: WatchStock): Promise<void> {\n    if (!this.isAlreadyWatched(watch)) {\n      try {\n        const dbManager = await this.getWatchDBM();\n        const _ = await dbManager.add(watch);\n        const mo = new MOWatchStock(); // found no way to create a ManagedObject as proper typescript class\n        mo.setProperty(\"symbol\", watch.symbol);\n        mo.setProperty(\"name\", watch.name);\n        mo.setAggregation(\"watchSince\", watch.watchSince);\n        this.addAggregation(\"watchlist\", mo);\n        this.getModel(\"component\")?.refresh();\n      } catch (err) {\n        console.error(err);\n        return new Promise((_, reject) => reject(err));\n      }\n    }\n  }\n  public async addToYFinPool(\n    symbol: Symbol[],\n    filter: YFinPoolFilter\n  ): Promise<void> {\n    const newYFP = this.yFinPool.then((yfp) => {\n      symbol.forEach((s) => {\n        if (s) {\n          if (!yfp[s]) {\n            // symbol not yet in pool\n            yfp[s] = { filter: [filter] } as YFinPoolEntry;\n          } else {\n            if (!yfp[s].filter) {\n              yfp[s] = { filter: [filter] } as YFinPoolEntry;\n            } else {\n              // symbol already in pool, only adjust usage filter\n              yfp[s].filter.push(filter);\n            }\n          }\n        }\n      });\n      return yfp;\n    });\n    this.yFinPool = newYFP;\n    await this.refreshYFinPool();\n  }\n\n  public getYFinPool() {\n    return this.yFinPool;\n  }\n\n  public async refreshYFinPool(): Promise<void> {\n    const apiKey = this.getProperty(\"apiKey\");\n    if (!apiKey) {\n      return;\n    }\n    const yfp = await this.yFinPool;\n    const symbolsToFetch = Object.keys(yfp);\n    // retain filters\n    const filters = Object.values(yfp).reduce((acc, o) => {\n      acc[o.symbol] = o.filter;\n      return acc;\n    }, {} as Record<Symbol, YFinPoolFilter[]>);\n    console.log(\"symbolsToFetch=\", symbolsToFetch);\n    const yFinQuoteResults = await this.fetchFromYFin(symbolsToFetch);\n    const newYfp = yFinQuoteResults.reduce((acc, r) => {\n      acc[r.symbol] = { ...r, filter: filters[r.symbol] }; // update and restore retained filter\n      return acc;\n    }, {} as typeof yfp);\n    this.yFinPool = new Promise((resolve) => resolve(newYfp));\n  }\n\n  private async fetchFromYFin(\n    symbolsToFetch: Symbol[]\n  ): Promise<YFinQuoteResult[]> {\n    const apiKey = this.getProperty(\"apiKey\");\n    const doUseCache = this.getProperty(\"useCache\") as boolean;\n    const cacheInterval = this.getProperty(\"cacheInterval\") as number;\n    if (!apiKey) {\n      return [];\n    }\n    if (doUseCache) {\n      console.log(\"Component:fetchFromYFin:doUseCache:\", doUseCache);\n      console.log(\"Component:fetchFromYFin:cacheInterval:\", cacheInterval);\n      const fetchBatchApi = api_getAssetBatch(apiKey);\n      const fetchBatchApiFn = fetchBatchApi.fetchBatch;\n      const fetchBatchApiFnCached = useCache<\n        YFinQuoteResult[],\n        typeof fetchBatchApiFn\n      >(fetchBatchApiFn, { timeOutMillis: cacheInterval });\n      let result: YFinQuoteResult[] = [];\n      for (var start = 0; start < symbolsToFetch.length; ) {\n        const bachEnd = Math.min(\n          symbolsToFetch.length,\n          start + fetchBatchApi.MAX_BATCH_SIZE\n        );\n        const batch = symbolsToFetch.slice(start, bachEnd);\n        start = bachEnd;\n        //fetchBatchApi.fetchBatch(batch,undefined) // TODO use abort controller to abort api call in case of premature leaving view\n        let quoteResults = await fetchBatchApiFnCached([batch, undefined]); // TODO use abort controller to abort api call in case of premature leaving view\n        result = result.concat(quoteResults);\n      }\n      return result;\n    } else {\n      console.log(\"Component:fetchFromYFin:doUseCache:\", doUseCache);\n      const fetchBatchApi = api_getAssetBatch(apiKey);\n      //const fetchBatchApiFn = fetchBatchApi.fetchBatch\n      //const fetchBatchApiFnCached = useCache<YFinQuoteResult[], typeof fetchBatchApiFn>(fetchBatchApiFn, {timeOutMillis:cacheInterval})\n      let result: YFinQuoteResult[] = [];\n      for (var start = 0; start < symbolsToFetch.length; ) {\n        const bachEnd = Math.min(\n          symbolsToFetch.length,\n          start + fetchBatchApi.MAX_BATCH_SIZE\n        );\n        const batch = symbolsToFetch.slice(start, bachEnd);\n        start = bachEnd;\n        let quoteResults = await fetchBatchApi.fetchBatch(batch, undefined); // TODO use abort controller to abort api call in case of premature leaving view\n        //let quoteResults = await fetchBatchApiFnCached([batch,undefined]) // TODO use abort controller to abort api call in case of premature leaving view\n        result = result.concat(quoteResults);\n      }\n      return result;\n    }\n  }\n  public async refreshWatchlistMarketData(): Promise<void> {\n    interface SymbolMOMap {\n      [symbol: string]: ManagedObject;\n    }\n    const apiKey = this.getProperty(\"apiKey\");\n    if (apiKey) {\n      const watched = this.getWatchlist();\n      const symbolsToMO: SymbolMOMap = watched.reduce((acc, mo) => {\n        const symbol = mo.getProperty(\"symbol\") as string;\n        acc[symbol] = mo;\n        return acc;\n      }, {} as SymbolMOMap); // maybe use Map<T,S> or Record<T,S>\n      const symbolsToFetch = Object.keys(symbolsToMO);\n      const fetchBatchApi = api_getAssetBatch(apiKey);\n      const fetchBatchApiFn = fetchBatchApi.fetchBatch;\n      const fetchBatchApiFnCached = useCache<\n        YFinQuoteResult[],\n        typeof fetchBatchApiFn\n      >(fetchBatchApiFn, { timeOutMillis: 1000 * 60 * 5 });\n      for (var start = 0; start < symbolsToFetch.length; ) {\n        const bachEnd = Math.min(\n          symbolsToFetch.length,\n          start + fetchBatchApi.MAX_BATCH_SIZE\n        );\n        const batch = symbolsToFetch.slice(start, bachEnd);\n        start = bachEnd;\n        fetchBatchApi\n          .fetchBatch(batch, undefined) // TODO use abort controller to abort api call in case of premature leaving view\n          //fetchBatchApiFnCached([batch,undefined]) // TODO use abort controller to abort api call in case of premature leaving view\n          .then((quotes) => {\n            quotes.forEach((quote) => {\n              const mo = symbolsToMO[quote.symbol];\n              if (mo) {\n                this.updateFromQuote(mo, quote);\n              } else {\n                console.warn(\n                  `no watch managed object found for ${quote.symbol}`\n                );\n              }\n            });\n          });\n      }\n    }\n  }\n  public updateFromQuote(mo: ManagedObject, quote: YFinQuoteResult): void {\n    const propertyMap = mo.getMetadata().getAllProperties();\n    const propertyNames = Object.keys(propertyMap);\n    const anyQuote: any = quote; // trick TypeScript\n    propertyNames.forEach((name) => {\n      if (anyQuote[name]) {\n        mo.setProperty(name, anyQuote[name]);\n      }\n    });\n  }\n  public getWatchlist(): ManagedObject[] {\n    return this.getAggregation(\"watchlist\") as ManagedObject[];\n  }\n}\n"],"mappings":"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","ignoreList":[]}