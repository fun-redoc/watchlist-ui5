/*!
* OpenUI5
 * (c) Copyright 2009-2024 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
*/
sap.ui.define(["sap/base/util/uid","sap/ui/base/ManagedObject","sap/ui/integration/util/BindingResolver","sap/ui/integration/util/openCardDialog","sap/ui/integration/util/Utils","sap/m/BusyIndicator"],(t,e,i,a,o,n)=>{"use strict";const r=e.extend("sap.ui.integration.delegate.Paginator",{metadata:{library:"sap.ui.integration",properties:{active:{type:"boolean",defaultValue:false},card:{type:"object"},configuration:{type:"object"},paginatorModel:{type:"object"}}}});r.create=function(t){if(!t){return null}const e=new r(t);e._applySettings();e._updatePaginatorModel();return e};r.prototype.init=function(){this._iPageNumber=0;this._iPageCount=0};r.prototype._applySettings=function(){const t=this.getConfiguration();const e=this.getCard();let a=t.pageSize;if(e.isSkeleton()&&!t.totalCount){a=e.getModelSizeLimit()}let o=e;const n=e.getCardContent();if(n){o=e.getCardContent()}this._iTotalCount=i.resolveValue(t.totalCount,o);this._iPageSize=i.resolveValue(a,o)};r.prototype.exit=function(){this._oBusyIndicator?.destroy()};r.prototype.openDialog=function(){const t=this.getCard();a(t,{manifest:this._createManifest(),baseUrl:t.getBaseUrl(),resizable:true,showCloseButton:true},true)};r.prototype.isServerSide=function(){return this._iTotalCount>0};r.prototype.onDataChanged=function(t){if(!t.hasData()){this._iPageCount=0;this.fireEvent("_ready");return}this._applySettings();const e=this._iTotalCount||t.getDataLength();this._iPageCount=Math.ceil(e/this._iPageSize);this._iPageNumber=Math.min(Math.max(0,this._iPageNumber),this._getLastPageNumber());if(!this.getActive()){this.fireEvent("_ready");return}if(this.isServerSide()){this._onDataChangedServerSidePagination(t,e);if(this._bInitialLoadComplete){this.fireEvent("_ready")}}else{this.fireEvent("_ready")}};r.prototype.setModelData=function(t,e){const i=this.getCard();const a=i.getManifestEntry("/sap.card/content/data/path")||i.getManifestEntry("/sap.card/data/path")||"/";const n=e.getProperty(a);const r=o.getNestedPropertyValue(t,a);if(n&&r){e.setProperty(a,n.concat(r))}else{e.setData(t)}this._loadingMore=false;this.fireEvent("_loadMoreComplete")};r.prototype.isLoadingMore=function(){return this._loadingMore};r.prototype.reset=function(){this.getPaginatorModel().setData({skip:0,size:0,pageIndex:0});this._iPageNumber=0;this._loadingMore=false};r.prototype.render=function(t){if(this._oBusyIndicator&&this.isLoadingMore()){t.renderControl(this._oBusyIndicator)}};r.prototype.getStaticConfiguration=function(){return{pageCount:this._iPageCount,pageIndex:this._iPageNumber}};r.prototype.getPageCount=function(){return this._iPageCount};r.prototype.getPageSize=function(){return this._iPageSize};r.prototype._onDataChangedServerSidePagination=function(t,e){const i=t.getInnerList();this._oBusyIndicator=this._oBusyIndicator||(new n).addStyleClass("sapUiIntPaginatorBusyIndicator");if(!this._bInitialLoadComplete&&t.getDataLength()<e){this._loadMore();this.attachEventOnce("_loadMoreComplete",()=>{this._bInitialLoadComplete=true})}else{this._bInitialLoadComplete=true}const a=t=>{if(this.isLoadingMore()){return}const i=300;if(t.target.scrollHeight-t.target.scrollTop-t.target.clientHeight<i&&this.getCard().getCardContent().getDataLength()<e){this._loadMore()}};const o={onAfterRendering:()=>{i.removeEventDelegate(o);const n=i.getDomRef().closest(".sapFCardContent");n.removeEventListener("scroll",a);n.addEventListener("scroll",a);if(!this.isLoadingMore()&&t.hasData()&&n.clientHeight>=n.scrollHeight&&t.getDataLength()<e){this._loadMore()}}};i.addEventDelegate(o)};r.prototype._loadMore=function(){if(!this.isServerSide()){return}this._loadingMore=true;this.getCard().getCardContent().invalidate();this._iPageNumber=Math.min(this._getLastPageNumber(),this._iPageNumber+1);this._updatePaginatorModel()};r.prototype._updatePaginatorModel=function(){this.getPaginatorModel().setData({skip:this._iPageNumber*this._iPageSize,size:this._iPageSize,pageIndex:this._iPageNumber})};r.prototype._getLastPageNumber=function(){return Math.max(0,this._iPageCount-1)};r.prototype._createManifest=function(){const e=this.getCard();const i=e.getManifestEntry("/");i["sap.app"].id=i["sap.app"].id+t();e.getAggregation("_filterBar")?._getFilters().forEach(t=>{t.writeValueToConfiguration(i["sap.card"].configuration.filters[t.getKey()])});return i};return r});
//# sourceMappingURL=Paginator.js.map