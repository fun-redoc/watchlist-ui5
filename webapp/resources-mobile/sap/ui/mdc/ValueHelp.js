/*!
 * OpenUI5
 * (c) Copyright 2009-2024 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/mdc/Element","sap/ui/mdc/mixin/PromiseMixin","sap/ui/mdc/condition/Condition","sap/ui/mdc/condition/FilterOperatorUtil","sap/ui/mdc/enums/ValueHelpSelectionType","sap/ui/model/base/ManagedObjectModel","sap/ui/base/ManagedObjectObserver","sap/ui/mdc/enums/ValueHelpPropagationReason","sap/ui/Device","sap/ui/mdc/enums/FieldDisplay"],(e,t,i,o,n,s,a,r,l,c)=>{"use strict";const p=e.extend("sap.ui.mdc.ValueHelp",{metadata:{library:"sap.ui.mdc",properties:{conditions:{type:"object[]",defaultValue:[],byValue:true},delegate:{type:"object",group:"Data",defaultValue:{name:"sap/ui/mdc/ValueHelpDelegate",payload:{}}},filterValue:{type:"string",defaultValue:""},validateInput:{type:"boolean",defaultValue:true},_config:{type:"object",defaultValue:{},visibility:"hidden"},_valid:{type:"boolean",group:"Appearance",defaultValue:true,visibility:"hidden"}},aggregations:{dialog:{type:"sap.ui.mdc.valuehelp.base.IDialogContainer",multiple:false},typeahead:{type:"sap.ui.mdc.valuehelp.base.ITypeaheadContainer",multiple:false}},events:{select:{parameters:{conditions:{type:"object[]"},add:{type:"boolean"},close:{type:"boolean"}}},disconnect:{},closed:{},open:{parameters:{container:{type:"sap.ui.mdc.valuehelp.base.Container"}}},opened:{parameters:{container:{type:"sap.ui.mdc.valuehelp.base.Container"},itemId:{type:"string"},items:{type:"int"}}},navigated:{parameters:{leaveFocus:{type:"boolean"},condition:{type:"object"},itemId:{type:"string"},caseSensitive:{type:"boolean"}}},switchToValueHelp:{},typeaheadSuggested:{parameters:{condition:{type:"object"},filterValue:{type:"string"},itemId:{type:"string"},items:{type:"int"},caseSensitive:{type:"boolean"}}},visualFocusSet:{}},defaultProperty:"filterValue"}});p.prototype.init=function(){e.prototype.init.apply(this,arguments);this._oObserver=new a(_.bind(this));this._oObserver.observe(this,{aggregations:["typeahead","dialog"]});this.setBindingContext(null);this._oConditions={}};p.prototype.exit=function(){delete this._oConditions;this._oObserver.disconnect();this._oObserver.destroy();delete this._oObserver;if(this._oManagedObjectModel){this._oManagedObjectModel.destroy();delete this._oManagedObjectModel}};p.prototype.invalidate=function(e){return};p.prototype.connect=function(e,t){const i=this.getTypeahead();const o=this.getDialog();if(this._oControl&&this._oControl!==e){this.close();this.setFilterValue("");this.setConditions([]);if(i){i.onConnectionChange()}if(o){o.onConnectionChange()}this.fireDisconnect()}this._oControl=e;this.setProperty("_config",t,true);D.call(this);if(i){P.call(this,i,!!this._oControl)}if(o){P.call(this,o,!!this._oControl)}return this};p.prototype.getControl=function(){return this._oControl};p.prototype.getDomRef=function(){const e=this.getTypeahead();const t=this.getDialog();if(e&&(e.isOpen()||e.isOpening())){return e.getDomRef()}else if(t&&(t.isOpen()||t.isOpening())){return t.getDomRef()}};p.prototype.getAriaAttributes=function(e){const t=this.getTypeahead();let i=this.getDialog();if(!i&&t&&t.getUseAsValueHelp()){i=t}const o=t&&t.isOpen();const n=i&&i.isOpen();const s=t&&t.getAriaAttributes(e);const a=i&&i.getAriaAttributes(e);let r;if(o){r=s.contentId}else if(n){r=a.contentId}const l=t&&s.ariaHasPopup||i&&a.ariaHasPopup;const c=t&&s.role||i&&a.role;const p=t&&s.roleDescription||i&&a.roleDescription;const u=!!i&&a.valueHelpEnabled;const h=t&&s.autocomplete||i&&a.autocomplete;return{contentId:r,ariaHasPopup:l,role:c,roleDescription:p,valueHelpEnabled:u,autocomplete:h}};p.prototype._retrieveDelegateContent=function(e,t){let i;if(!t){const i=e.getSelectedContent();t=i&&i.getId()}i=this._retrievePromise("delegateContent");const o=this.isOpen();if(!i||i&&o||i&&i.aggregation!==e.sParentAggregationName){const o=function(){return this._getControlDelegatePromise().then(i=>i.retrieveContent(this,e,t))}.bind(this);const n=i&&i.isPending();i=this._addPromise("delegateContent",n?i.getInternalPromise().then(o):o);i.aggregation=e.sParentAggregationName}return i.getInternalPromise()};p.prototype._getControlDelegatePromise=function(e){return this._retrievePromise("delegate",this.initControlDelegate.bind(this))};p.prototype.open=function(e){const t=e?this.getTypeahead():V.call(this);const i=e?this.getDialog():this.getTypeahead();if(i&&t!==i&&(i.isOpen()||i.isOpening())){i.close()}if(t&&!t.isOpen()&&!t.isOpening()){t.open(this._retrieveDelegateContent(t),e);this.fireOpen({container:t})}};function u(e){const t=e.getSource();this._retrieveDelegateContent(t,e.getParameter("contentId"))}function h(e){this.fireSwitchToValueHelp()}p.prototype.close=function(){const e=this.getTypeahead();const t=this.getDialog();if(e&&e.isOpen()){e.close()}if(t&&t.isOpen()){t.close()}};p.prototype.toggleOpen=function(e){const t=this.getTypeahead();let i=this.getDialog();if(!e&&!i&&t&&t.getUseAsValueHelp()){i=t}const o=t&&t.isOpen();const n=i&&i.isOpen();if(e&&o||!e&&n){this.close()}else if(e&&t||!e&&i){this.open(e)}};p.prototype.isOpen=function(){const e=this.getTypeahead();const t=this.getDialog();return!!(e&&(e.isOpen()||e.isOpening())||t&&(t.isOpen()||t.isOpening()))};p.prototype.skipOpening=function(){const e=this.getTypeahead();const t=this.getDialog();if(e&&e.isOpening()){e.close()}if(t&&t.isOpening()){t.close()}};p.prototype.initBeforeOpen=function(e){};p.prototype.isTypeaheadSupported=function(){const e=this.getTypeahead();if(e){return this._retrieveDelegateContent(e).then(()=>!!e&&e.isTypeaheadSupported())}else{return Promise.resolve(false)}};p.prototype.shouldOpenOnFocus=function(){const e=V.call(this,true);return this._getControlDelegatePromise().then(t=>e?e.shouldOpenOnFocus():Promise.resolve(false))};p.prototype.shouldOpenOnClick=function(){const e=V.call(this,true);return this._getControlDelegatePromise().then(t=>e?e.shouldOpenOnClick():Promise.resolve(false))};p.prototype.isFocusInHelp=function(){const e=V.call(this);return e&&e.isFocusInHelp()};p.prototype.removeVisualFocus=function(){const e=this.getTypeahead();if(e){e.removeVisualFocus()}};p.prototype.setVisualFocus=function(){const e=this.getTypeahead();if(e){e.setVisualFocus()}};p.prototype.navigate=function(e){const t=this.getTypeahead();if(t){const i=()=>{if(t.shouldOpenOnNavigate()&&!t.isOpening()&&!t.isOpen()){return t.open(true).then(()=>{t.navigate(e)})}return t.navigate(e)};const o=this._retrievePromise("navigate");const n=o&&!o.isSettled()&&o.getInternalPromise();this._addPromise("navigate",n?n.then(i):this._retrieveDelegateContent(t).then(i))}};p.prototype.isNavigationEnabled=function(e){const t=this.getTypeahead();if(t){const i=this.getDialog();const o=t.isOpen();if(o||!i){return t.isNavigationEnabled(e)}}return false};p.prototype.getItemForValue=function(e){const t=this.getTypeahead();if(t){return this._retrieveDelegateContent(t).then(()=>{e.caseSensitive=e.hasOwnProperty("caseSensitive")?e.caseSensitive:false;const i=t.getItemForValue(e);return i})}else{return Promise.reject("No Typeahead")}};p.prototype.isValidationSupported=function(){const e=this.getTypeahead();return e&&e.isValidationSupported()};p.prototype.onControlChange=function(){if(this.isDestroyed()){return}g.call(this,r.ControlChange);D.call(this)};p.prototype.getIcon=function(){const e=this.getTypeahead();const t=this.getDialog();if(t){return t.getValueHelpIcon()}else if(e){return e.getValueHelpIcon()}};p.prototype.getMaxConditions=function(){const e=this.getProperty("_config");return e&&e.maxConditions||-1};p.prototype.getDisplay=function(){return this.getProperty("_config")?.display||c.Value};p.prototype.getDataType=function(){};function g(e,t){const i=this.bDelegateInitialized&&this.getControlDelegate();if(i){i.onConditionPropagation(this,e,t||this.getProperty("_config"))}}function d(e){const t=e.getParameter("condition");this.fireNavigated({condition:t,itemId:e.getParameter("itemId"),leaveFocus:e.getParameter("leaveFocus"),caseSensitive:e.getParameter("caseSensitive")})}function f(e){this.fireVisualFocusSet()}function y(e){const t=e.getParameter("condition");const i=e.getParameter("filterValue");const o=e.getParameter("itemId");const n=e.getParameter("items");const s=e.getParameter("caseSensitive");this.fireTypeaheadSuggested({condition:t,filterValue:i,itemId:o,items:n,caseSensitive:s})}function m(e){const t=e.getParameter("type");const i=e.getParameter("conditions")||[];const o=this.getControlDelegate();const s=(e,t)=>t.findIndex(t=>o.compareConditions(this,e,t));let a;const r=this.getMaxConditions()===1;if(r){a=t===n.Remove?[]:i.slice(0,1)}if(t===n.Set){a=[].concat(r?i.slice(0,1):i)}if(t===n.Add){if(r){a=i.slice(0,1)}else{a=this.getConditions();for(let e=0;e<i.length;e++){if(s(i[e],a)===-1){a.push(i[e])}}}}if(t===n.Remove){if(r){a=[]}else{a=this.getConditions();for(let e=0;e<i.length;e++){const t=s(i[e],a);if(t!==-1){a.splice(t,1)}}}}if(a){this.setProperty("conditions",a,true)}}function v(e){if(this.getProperty("_valid")){const t=this.getMaxConditions()===1;const n=e.getParameter("close");const s=typeof n!=="undefined"?n:t;let a=this.getConditions();const l=!t&&!e.getSource().isMultiSelect();if(s){this.close()}a=i._removeEmptyConditions(a);a=i._removeInitialFlags(a);o.updateConditionsValues(a);this.fireSelect({conditions:a,add:l,close:s});g.call(this,r.Select)}}function C(e){this.close()}function O(e){this.fireOpened({container:e.getSource(),itemId:e.getParameter("itemId"),items:e.getParameter("items")})}function b(e){this._removePromise("delegateContent");this._removePromise("navigate");this.fireClosed()}function _(e){if(["typeahead","dialog"].indexOf(e.name)!==-1){const t=e.child;const i=e.mutation==="insert";if(this._oControl||!i){P.call(this,t,i)}if(i){if(!this._oManagedObjectModel){this._oManagedObjectModel=new s(this)}t.setModel(this._oManagedObjectModel,"$valueHelp")}}}function P(e,t){if(e._bAttached===t){return}const i=t?e.attachEvent.bind(e):e.detachEvent.bind(e);i("select",m,this);i("requestDelegateContent",u,this);i("confirm",v,this);i("cancel",C,this);i("opened",O,this);i("closed",b,this);if(e.attachRequestSwitchToDialog){i("requestSwitchToDialog",h,this)}if(e.attachNavigated){i("navigated",d,this)}if(e.attachVisualFocusSet){i("visualFocusSet",f,this)}if(e.attachTypeaheadSuggested){i("typeaheadSuggested",y,this)}e._bAttached=t}function D(){const e=this._oControl?this._oControl.getBindingContext():null;this.setBindingContext(e)}function V(e){const t=this.getTypeahead();const i=!!t&&t.getUseAsValueHelp();const o=this.getDialog();if(e){return(i||o||l.system.phone)&&t||o}else{return o||i&&t}}p.prototype._getFieldGroupIds=function(){const t=this.getControl();if(t){return t.getFieldGroupIds()}else{return e.prototype._getFieldGroupIds.apply(this,arguments)}};p.prototype.setHighlightId=function(e){this.getTypeahead()?.setHighlightId(e)};p.prototype.clone=function(t,i){const o=this.getTypeahead();const n=o?._bAttached;const s=this.getDialog();const a=s?._bAttached;if(n){P.call(this,o,false)}if(a){P.call(this,s,false)}const r=e.prototype.clone.apply(this,arguments);if(n){P.call(this,o,true)}if(a){P.call(this,s,true)}return r};t.call(p.prototype);return p});
//# sourceMappingURL=ValueHelp.js.map