/*!
 * OpenUI5
 * (c) Copyright 2009-2024 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/base/Object","sap/ui/base/DataType","sap/base/util/merge","sap/base/util/isPlainObject","sap/base/Log","sap/ui/core/Lib","sap/base/util/deepEqual"],(e,t,r,o,i,n,a)=>{"use strict";const p={key:{type:"string",mandatory:true,inComplexProperty:{allowed:true}},label:{type:"string",mandatory:true,inComplexProperty:{allowed:true}},tooltip:{type:"string",inComplexProperty:{allowed:true}},visible:{type:"boolean",default:{value:true},inComplexProperty:{allowed:true}},path:{type:"string"},dataType:{type:"string",mandatory:true},formatOptions:{type:"object"},constraints:{type:"object"},maxConditions:{type:"int",default:{value:-1}},caseSensitive:{type:"boolean",default:{value:true}},group:{type:"string",inComplexProperty:{allowed:true}},groupLabel:{type:"string",inComplexProperty:{allowed:true}},filterable:{type:"boolean",default:{value:true},inComplexProperty:{valueIfNotAllowed:false}},sortable:{type:"boolean",default:{value:true},inComplexProperty:{valueIfNotAllowed:false}},propertyInfos:{type:"PropertyReference[]",inComplexProperty:{allowed:true}}};const s={key:"name"};const l={isComplex:function(){return S.isPropertyComplex(this)},getSimpleProperties:function(){return this.propertyInfosProperties||[this]},getSortableProperties:function(){return this.getSimpleProperties().filter(e=>e.sortable)},getFilterableProperties:function(){return this.getSimpleProperties().filter(e=>e.filterable)},getVisibleProperties:function(){return this.getSimpleProperties().filter(e=>e.visible)}};const u=["key","label","tooltip","visible","path","dataType","formatOptions","constraints","maxConditions","group","groupLabel","caseSensitive"];const f=new WeakMap;function c(e){return JSON.stringify(e,(e,t)=>t===undefined?null:t)||""}function y(e,t){const r=n.all();if(!(window["sap-ui-mdc-config"]&&window["sap-ui-mdc-config"].disableStrictPropertyInfoValidation||new URLSearchParams(window.location.search).get("sap-ui-xx-disableStrictPropertyValidation")=="true")&&!("sap.fe.core"in r||"sap.fe.macros"in r||"sap.sac.df"in r)||new URLSearchParams(window.location.search).get("sap-ui-xx-enableStrictPropertyValidation")=="true"){d(e,t)}if(i.getLevel()<i.WARNING){return}const o=c(t);i.warning("Invalid property definition: "+e+(o?"\n"+o:""))}function d(e,t){const r=t?c(t):null;throw new Error("Invalid property definition: "+e+(r?"\n"+r:""))}function P(e,t){t.map(e=>{Object.keys(l).forEach(t=>{Object.defineProperty(e,t,{value:function(){return l[t].call(this)},writable:true})})})}function b(e){const t=Object.getOwnPropertyNames(e);Object.freeze(e);for(let r=0;r<t.length;r++){const i=e[t[r]];if(typeof i==="function"){Object.freeze(i)}else if(o(i)&&!Object.isFrozen(i)){b(i)}else if(Array.isArray(i)){b(i)}}}function g(e,t){if(!t){return e}return t.split(".").reduce((e,t)=>e&&e[t]?e[t]:null,e)}function m(e){let r;if(typeof e==="object"){r="object"}else{r=e.replace("PropertyReference","string")}return t.getType(r)}function h(e){const t=m(e);if(t.isArrayType()){return t.getBaseType().getDefaultValue()}else{return t.getDefaultValue()}}function v(e,t,r){t.forEach(t=>{e.prepareProperty(t,r)});b(t)}function w(e,t,r,o,i,n){const a=o==null;let p=[];const s=S.isPropertyComplex(t);if(a){n=f.get(e).mAttributeMetadata;i=t}if(!i){return[]}for(const l in n){const u=n[l];const f=a?l:o+"."+l;const c=i[l];if(s&&!u.inComplexProperty.allowed){if("valueIfNotAllowed"in u.inComplexProperty){i[l]=u.inComplexProperty.valueIfNotAllowed}continue}if(c!=null&&typeof u.type==="string"&&u.type.startsWith("PropertyReference")||f==="propertyInfos"){if(s||f!=="propertyInfos"){x(i,l,r)}continue}if(c==null){C(i,u,o,l,p,c)}if(typeof u.type==="object"){p=p.concat(w(e,t,r,f,i[l],u.type))}}return p}function x(e,t,r){const o=e[t];let i;let n=t;if(Array.isArray(o)){i=o.map(e=>r[e]);n+="Properties"}else{i=r[o];n+="Property"}Object.defineProperty(e,n,{value:i})}function C(e,t,o,i,n,a){const p=t.default;if(p.ignoreIfNull&&a===null){return}if(typeof p.value==="string"&&p.value.startsWith("attribute:")){n.push({source:p.value.substring(p.value.indexOf(":")+1),targetPath:o,targetAttribute:i,targetType:t.type})}else if(Array.isArray(p.value)){e[i]=r([],p.value)}else if(typeof p.value==="object"&&p.value!==null){e[i]=r({},p.value)}else{e[i]=p.value}}function A(e){return Object.freeze(e.reduce((e,t)=>{e[t.key]=t;return e},{}))}function j(e,t){for(const r in e){const o=e[r];const i=!t;o.mandatory=o.mandatory===true&&i;o.default={...o.default};o.default.value=o.default.value??h(o.type);o.inComplexProperty={...o.inComplexProperty};if(o.inComplexProperty.allowed===true){o.inComplexProperty.allowed=i||t.inComplexProperty.allowed===true}else if(!("allowed"in o.inComplexProperty)){const e=t?.inComplexProperty.allowed===true&&t?.inComplexProperty.propagateAllowance!==false;o.inComplexProperty.allowed=e}if(typeof o.type==="object"){j(o.type,o)}delete o.inComplexProperty.propagateAllowance}}function O(e,t){if(!Array.isArray(t)){d("Property infos must be an array.")}const o=f.get(e);const i=r([],t);e.validateProperties(i,o.aPreviousRawProperties);const n=I(i);const a=A(n);P(e,n);v(e,n,a);e._validatePropertyConsistency(n,o.aProperties);o.aProperties=n;o.mProperties=a;o.aPreviousRawProperties=r([],t)}function I(e){const t=Object.entries(s);return e.map(e=>{const r={...e};t.forEach(([t,o])=>{if(t in e&&o in e&&e[t]!==e[o]){d(`The values of legacy-attribute '${o}' and it's replacement '${t}' must be identical.`,e)}if(!(t in e)&&o in e){r[t]=e[o]}if(!(o in e)&&t in e){r[o]=e[t]}});return r})}function M(e){return e.key||s["key"]&&e[s["key"]]}const S=e.extend("sap.ui.mdc.util.PropertyHelper",{constructor:function(t,r,o){e.call(this);if(r&&!e.isObjectA(r,"sap.ui.base.ManagedObject")){throw new Error("The type of the parent is invalid.")}Object.keys(o||{}).forEach(e=>{if(e in p&&o[e]!==true){throw new Error("The attribute '"+e+"' is reserved and cannot be overridden by additional attributes.")}});const i={};const n=Object.keys(o||{});i.mAttributeMetadata=u.concat(n).reduce((e,t)=>{e[t]=t in p?p[t]:o[t];return e},{});j(i.mAttributeMetadata);i.aMandatoryAttributes=Object.keys(i.mAttributeMetadata).filter(e=>i.mAttributeMetadata[e].mandatory);i.oParent=r||null;f.set(this,i);O(this,t)}});S.prototype.validateProperties=function(e,t){const r=new Set;for(let o=0;o<e.length;o++){this.validateProperty(e[o],e,t);r.add(M(e[o]))}if(r.size!==e.length){d("Properties do not have unique keys.")}};S.prototype._validatePropertyConsistency=function(e,t){if(t?.length){const r=f.get(this);const{mAttributeMetadata:o}=r;const i=[];for(const r of t){const t=M(r);const n=e.find(e=>M(e)===t);if(!n){i.push({[t]:"PROPERTY_MISSING"})}else{const e=Object.entries(o).reduce((e,[t,o])=>{if(!a(r[t],n[t])){return[...e,{[t]:[r[t],n[t]]}]}return e},[]);if(e.length){i.push({[t]:e})}}}if(i.length){y(`Detected property info modifications after update:`,i)}}};S.prototype.validateProperty=function(e,t,r){if(!o(e)){d("Property info must be a plain object.")}T(this,e,t);if(S.isPropertyComplex(e)){if(!e.propertyInfos||e.propertyInfos.length===0){d("Complex property does not reference existing properties.",e)}}const i=f.get(this);i.aMandatoryAttributes.forEach(t=>{const r=i.mAttributeMetadata[t];const o=r.inComplexProperty.allowed;const n=s[t];const a=n&&n in e;const p=a?e[n]==null:e[t]==null;if(p&&S.isPropertyComplex(e)&&!o){return}if(!(t in e||a)){y("Property does not contain mandatory attribute '"+t+"'.",e)}else if(p){d("Property does not contain mandatory attribute '"+t+"'.",e)}})};function T(e,t,r,o,i,n){const a=o==null;if(a){n=f.get(e).mAttributeMetadata;i=t}for(const p in i){let l=n[p];const u=a?p:o+"."+p;const f=i[p];if(!l){l=n[Object.entries(s).find(e=>e[1]===p)?.[0]]}if(!l){y("Property contains invalid attribute '"+u+"'.",t)}else if(S.isPropertyComplex(t)&&!l.inComplexProperty.allowed){y("Complex property contains invalid attribute '"+u+"'.",t)}else if(typeof l.type==="object"&&f&&typeof f==="object"){T(e,t,r,u,f,l.type)}else if(f!=null&&!m(l.type).isValid(f)){d("The value of '"+u+"' is invalid.",t)}else if(f&&typeof l.type==="string"&&l.type.startsWith("PropertyReference")){k(e,t,r,u,f,l)}}}function k(e,t,r,o,i,n){const a=n.type.endsWith("[]")?i:[i];const p=new Set(a);if(a.indexOf(M(t))>-1){d("Property references itself in the '"+o+"' attribute.",t)}if(p.size!==a.length){d("Property contains duplicate names in the '"+o+"' attribute.",t)}for(let e=0;e<r.length;e++){if(p.has(M(r[e]))){if(S.isPropertyComplex(r[e])){d("Property references complex properties in the '"+o+"' attribute.",t)}p.delete(M(r[e]))}}if(p.size>0){d("Property references non-existing properties in the '"+o+"' attribute.",t)}}S.prototype.prepareProperty=function(e,t){const r=w(this,e,t);r.forEach(r=>{const o=g(e,r.targetPath);if(o){let i=g(e,r.source);if(i==null){i=h(r.targetType)}o[r.targetAttribute]=i;if(typeof r.targetType==="string"&&r.targetType.startsWith("PropertyReference")){x(o,r.targetAttribute,t)}}})};S.prototype.getParent=function(){const e=f.get(this);return e?e.oParent:null};S.prototype.setProperties=function(e){O(this,e)};S.prototype.getProperties=function(){const e=f.get(this);return e?e.aProperties:[]};S.prototype.getPropertyMap=function(){const e=f.get(this);return e?e.mProperties:{}};S.prototype.getProperty=function(e){return this.getPropertyMap()[e]||null};S.prototype.hasProperty=function(e){return e in this.getPropertyMap()};S.isPropertyComplex=function(e){return e!=null&&typeof e==="object"?"propertyInfos"in e:false};S.prototype.getSortableProperties=function(){return this.getProperties().filter(e=>e.sortable)};S.prototype.getFilterableProperties=function(){return this.getProperties().filter(e=>e.filterable)};S.prototype.getVisibleProperties=function(){return this.getProperties().filter(e=>e.visible)};S.prototype.destroy=function(){e.prototype.destroy.apply(this,arguments);f.delete(this)};S.prototype._getAttributeMetadata=function(){const e=f.get(this);return e?r({},e.mAttributeMetadata):null};return S});
//# sourceMappingURL=PropertyHelper.js.map