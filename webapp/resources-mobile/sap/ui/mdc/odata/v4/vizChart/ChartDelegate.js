/*!
 * OpenUI5
 * (c) Copyright 2009-2024 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Element","sap/ui/core/Lib","sap/ui/mdc/odata/v4/ChartDelegate","sap/m/Text","sap/base/Log","sap/ui/mdc/util/FilterUtil","sap/ui/mdc/odata/v4/util/DelegateUtil","sap/ui/mdc/chart/Item","sap/ui/model/Sorter","sap/ui/mdc/chart/ChartImplementationContainer","sap/ui/base/ManagedObjectObserver","sap/ui/mdc/p13n/panels/ChartItemPanel","sap/m/p13n/MessageStrip","sap/ui/mdc/FilterBarDelegate","sap/ui/model/Filter","sap/ui/mdc/chart/PropertyHelper","sap/ui/thirdparty/jquery","sap/ui/mdc/enums/ChartItemRoleType","sap/base/util/merge"],(e,t,a,n,r,i,o,s,l,u,g,c,h,d,p,m,jQuery,f,y)=>{"use strict";const _=Object.assign({},a);const C=new window.WeakMap;let b;let I;let S;let D;let P;_._getState=function(e){if(C.has(e)){return C.get(e)}if(e){r.info("Couldn't get state for "+e.getId())}};_._setState=function(e,t){C.set(e,t)};_.getFilterDelegate=function(){return d};_.addCondition=function(e,t,a){return Promise.resolve()};_.removeCondition=function(e,t,a){return Promise.resolve()};_._deleteState=function(e){if(this._getState(e)){if(this._getState(e).vizTooltip){this._getState(e).vizTooltip.destroy()}if(this._getState(e).observer){this._getState(e).observer.disconnect();this._getState(e).observer=null}}return C.delete(e)};_._getChart=function(e){if(C.has(e)){return C.get(e).innerChart}if(e){r.info("Couldn't get state for "+e.getId())}return undefined};_._setChart=function(e,t){if(C.has(e)){C.get(e).innerChart=t}else{C.set(e,{innerChart:t})}};_._getInnerStructure=function(e){if(C.has(e)){return C.get(e).innerStructure}if(e){r.info("Couldn't get state for "+e.getId())}return undefined};_._setInnerStructure=function(e,t){if(C.has(e)){C.get(e).innerStructure=t}else{C.set(e,{innerStructure:t})}};_._getBindingInfoFromState=function(e){if(C.has(e)){const t=C.get(e).bindingInfo;if(t){delete t.events}return t}if(e){r.info("Couldn't get state for "+e.getId())}return undefined};_._setBindingInfoForState=function(e,t){if(C.has(e)){C.get(e).bindingInfo=t}else{C.set(e,{bindingInfo:t})}};_._setUpChartObserver=function(e){const t=this._getState(e);if(!t.observer){t.observer=new g(e=>{if(e.type==="destroy"){this.exit(e.object)}})}t.observer.observe(e,{destroy:true})};_.exit=function(e){if(this._getInnerStructure(e)){this._getInnerStructure(e).destroy()}this._deleteState(e)};_.zoomIn=function(e){const t=this._getChart(e);if(t){t.zoom({direction:"in"})}};_.zoomOut=function(e){const t=this._getChart(e);if(t){t.zoom({direction:"out"})}};_.getZoomState=function(e){if(this._getChart(e)){const t=this._getChart(e).getZoomInfo();if(t&&t.hasOwnProperty("currentZoomLevel")&&t.currentZoomLevel!=null&&t.enabled){return{enabled:t.enabled,enabledZoomIn:t.currentZoomLevel<1,enabledZoomOut:t.currentZoomLevel>0}}}return{enabled:false}};_.getInnerChartSelectionHandler=function(e){return{eventId:"_selectionDetails",listener:this._getChart(e)}};_.getChartTypeLayoutConfig=function(){if(this._aChartTypeLayout){return this._aChartTypeLayout}const e=[f.axis1,f.category,f.series];const t=[f.axis1,f.axis2,f.category,f.series];const a=[f.axis1,f.category,f.category2];const n=[f.axis1,f.axis2,f.axis3,f.category,f.series];this._aChartTypeLayout=[{key:"column",allowedLayoutOptions:e},{key:"bar",allowedLayoutOptions:e},{key:"line",allowedLayoutOptions:e},{key:"combination",allowedLayoutOptions:e},{key:"pie",allowedLayoutOptions:e},{key:"donut",allowedLayoutOptions:e},{key:"dual_column",allowedLayoutOptions:t},{key:"dual_bar",allowedLayoutOptions:t},{key:"dual_line",allowedLayoutOptions:t},{key:"stacked_bar",allowedLayoutOptions:e},{key:"scatter",allowedLayoutOptions:t},{key:"bubble",allowedLayoutOptions:n},{key:"heatmap",allowedLayoutOptions:a},{key:"bullet",allowedLayoutOptions:e},{key:"vertical_bullet",allowedLayoutOptions:e},{key:"dual_stacked_bar",allowedLayoutOptions:t},{key:"100_stacked_bar",allowedLayoutOptions:e},{key:"stacked_column",allowedLayoutOptions:e},{key:"dual_stacked_column",allowedLayoutOptions:t},{key:"100_stacked_column",allowedLayoutOptions:e},{key:"dual_combination",allowedLayoutOptions:t},{key:"dual_horizontal_combination",allowedLayoutOptions:t},{key:"dual_horizontal_combination",allowedLayoutOptions:t},{key:"dual_stacked_combination",allowedLayoutOptions:t},{key:"dual_horizontal_stacked_combination",allowedLayoutOptions:t},{key:"stacked_combination",allowedLayoutOptions:e},{key:"100_dual_stacked_bar",allowedLayoutOptions:e},{key:"100_dual_stacked_column",allowedLayoutOptions:e},{key:"horizontal_stacked_combination",allowedLayoutOptions:e},{key:"waterfall",allowedLayoutOptions:a},{key:"horizontal_waterfall",allowedLayoutOptions:a}];return this._aChartTypeLayout};_.getAdaptionUI=function(e){return Promise.resolve(this._setupAdaptionUI(e))};_._setupAdaptionUI=function(e){let a=this.getChartTypeLayoutConfig().find(t=>t.key===e.getChartType());if(!a){const t=[f.axis1,f.axis2,f.axis3,f.category,f.category2,f.series];a={key:e.getChartType(),allowedLayoutOptions:t}}const n=[{kind:"Groupable"},{kind:"Aggregatable"}];a.templateConfig=n;const r={panelConfig:a};const i=new c(r);if(e.getChartType()==="heatmap"){const e=t.getResourceBundleFor("sap.ui.mdc");i.setMessageStrip(new h({text:e.getText("chart.PERSONALIZATION_DIALOG_MEASURE_WARNING"),type:"Warning"}))}return i};_.setLegendVisible=function(e,t){if(this._getChart(e)){this._getChart(e).setVizProperties({legend:{visible:t},sizeLegend:{visible:t}})}else{r.error("Could not set legend visibility since inner chart is not yet initialized!")}};_._getSorterForItem=function(e,t){if(e.getType()==="aggregatable"){return new l(this._getAggregatedMeasureNameForMDCItem(e),t.descending)}else if(e.getType()==="groupable"){return new l(this.getInternalChartNameFromPropertyNameAndKind(t.key,"groupable",e.getParent()),t.descending)}};_.insertItemToInnerChart=function(e,t,a){if(t.getType()==="groupable"){const n=this.getInternalChartNameFromPropertyNameAndKind(t.getPropertyKey(),"groupable",e);const r=this._getChart(e).getDimensionByName(n);if(!r){this.createInnerDimension(e,t)}else{r.setLabel(t.getLabel());r.setRole(t.getRole()?t.getRole():"category")}const i=e._bDrillDown;if(i&&r){this._getChart(e).drillDown(r);e._bDrillDown=false}else if(!i){const t=this._getChart(e).getVisibleDimensions();t.splice(a,0,n);this._getChart(e).setVisibleDimensions(t)}}else if(t.getType()==="aggregatable"){this.createInnerMeasure(e,t);const n=this._getChart(e).getVisibleMeasures();n.splice(a,0,this._getAggregatedMeasureNameForMDCItem(t));this._getChart(e).setVisibleMeasures(n)}this._prepareColoringForItem(t).then(()=>{this._updateColoring(e,this._getChart(e).getVisibleDimensions(),this._getChart(e).getVisibleMeasures())});this._updateSemanticalPattern(e)};_.removeItemFromInnerChart=function(e,t){if(t.getType()==="groupable"&&this._getChart(e).getVisibleDimensions().includes(this.getInternalChartNameFromPropertyNameAndKind(t.getPropertyKey(),"groupable",e))){if(this._getState(e).inResultDimensions.length>0){this._getChart(e).setInResultDimensions(this._getState(e).inResultDimensions)}if(e._iDrillUpIndex){this._getChart(e).drillUp(e._iDrillUpIndex);e._iDrillUpIndex=0}else{let t=e.getItems().filter(e=>e.getType()==="groupable");t=t.map(function(t){return this.getInternalChartNameFromPropertyNameAndKind(t.getPropertyKey(),"groupable",e)}.bind(this));this._getChart(e).setVisibleDimensions(t)}}else if(t.getType()==="aggregatable"&&this._getChart(e).getVisibleMeasures().includes(this._getAggregatedMeasureNameForMDCItem(t))){const a=[];e.getItems().filter(e=>e.getType()==="aggregatable").filter(e=>e!==t).forEach(e=>{a.push(this._getAggregatedMeasureNameForMDCItem(e))});this._getChart(e).setVisibleMeasures(a);this._getChart(e).removeMeasure(this._getChart(e).getMeasureByName(this._getAggregatedMeasureNameForMDCItem(t)))}this._updateColoring(e,this._getChart(e).getVisibleDimensions(),this._getChart(e).getVisibleMeasures());this._updateSemanticalPattern(e)};_.addItem=function(e,t,a,n){if(e.getModel){return Promise.resolve(this._createMDCChartItem(t,e,n))}};_.removeItem=function(e,t){return Promise.resolve(true)};_.checkAndUpdateMDCItems=function(e){return new Promise((t,a)=>{const n=[];e.getItems().forEach(t=>{const a=t.getPropertyKey()&&t.getLabel()&&t.getType()&&t.getRole();if(!a){n.push(this._getPropertyInfosByName(t.getPropertyKey(),e).then(e=>{t.setLabel(e.label);if(e.groupable){t.setType("groupable");t.setRole(t.getRole()||e.role||"category")}else if(e.aggregatable){t.setType("aggregatable");t.setRole(t.getRole()||e.role||"axis1")}}))}});Promise.all(n).then(()=>{t()})})};_._createMDCChartItem=function(e,t,a){return this._getPropertyInfosByName(e,t).then(e=>{if(!e){return null}return this._createMDCItemFromProperty(e,t.getId(),a)})};_._createMDCItemFromProperty=function(e,t,a){if(e.groupable){return new s(t+"--GroupableItem--"+e.key,{propertyKey:e.key,label:e.label,type:"groupable",role:a?a:"category"})}if(e.aggregatable){return new s(t+"--AggregatableItem--"+e.key,{propertyKey:e.key,label:e.label,type:"aggregatable",role:a?a:"axis1"})}return null};_.initializeInnerChart=function(e){return new Promise((t,a)=>{this._loadChart().then(a=>{let r;this._setInnerStructure(e,new u(e.getId()+"--implementationContainer",{}));e.addStyleClass("sapUiMDCChartTempTextOuter");if(e.getNoData()){this._getInnerStructure(e).setChartNoDataContent(e.getNoData())}else{r=new n({text:e.getNoDataText()});this._getInnerStructure(e).addStyleClass("sapUiMDCChartTempText");this._getInnerStructure(e).setNoDataContent(r)}this._setUpChartObserver(e);t(this._getInnerStructure(e))})})};_.changedNoDataStruct=function(e){if(this._getInnerStructure(e)){this._getInnerStructure(e).setChartNoDataContent(e.getNoData());this._getInnerStructure(e).invalidate()}};_._createContentFromItems=function(e){return new Promise((t,a)=>{const n=[];const i=[];const o=[];const s=[];e.getItems().forEach((t,a)=>{i.push(this._getPropertyInfosByName(t.getPropertyKey(),e).then(a=>{if(!a){r.error("sap.ui.mdc.Chart: Item "+t.getPropertyKey()+" has no property info representing it in the metadata. Make sure the name is correct and the metadata is defined correctly. Skipping the item!");return}switch(t.getType()){case"groupable":o.push(this.getInternalChartNameFromPropertyNameAndKind(t.getPropertyKey(),"groupable",e));this._addInnerDimension(e,t,a);break;case"aggregatable":s.push(this._getAggregatedMeasureNameForMDCItem(t));this._addInnerMeasure(e,t,a);break;default:r.error("MDC Chart Item "+t.getId()+" with label "+t.getLabel()+' has no known type. Supported typed are: "groupable" & "aggregatable"')}n.push(this._prepareColoringForItem(t))}))});Promise.all(i).then(()=>{this._getState(e).aColMeasures.forEach(t=>{if(this._getState(e).aInSettings.indexOf(t)==-1){n.push(new Promise((a,n)=>{e._getPropertyByNameAsync(t).then(function(n){const{aggregationMethod:r,path:i}=n;const o=this.getInternalChartNameFromPropertyNameAndKind(t,"aggregatable",e);const l={name:o,label:n.label,role:n.role||"axis1"};if(r&&i){l.analyticalInfo={propertyPath:i,with:r}}if(n.unitPath){l.unitBinding=n.unitPath}const u=new D(l);s.push(u);this._getChart(e).addMeasure(u);a()})}))}});Promise.all(n).then(()=>{this._getChart(e).setVisibleDimensions(o);this._getChart(e).setVisibleMeasures(s);const a=e.getDelegate().inResultDimensions;if(a&&a instanceof Array&&a.length!=0){const t=[];a.forEach(a=>{t.push(this._getPropertyInfosByName(a,e).then(t=>{const a=_.innerDimensionFactory(e,undefined,t);this._getChart(e).addDimension(a);const n=this.getInternalChartNameFromPropertyNameAndKind(t.key,"groupable",e);this._getState(e).inResultDimensions.push(n)}))});Promise.all(t).then(()=>{this._getChart(e).setInResultDimensions(this._getState(e).inResultDimensions)})}this._updateColoring(e,o,s);this._updateSemanticalPattern(e);t()})})})};_.getInnerChart=function(e){return this._getChart(e)};_._prepareColoringForItem=function(e){return this._addCriticality(e).then(()=>{this._getState(e.getParent()).aInSettings.push(e.getPropertyKey());if(e.getType()==="aggregatable"){this._getPropertyInfosByName(e.getPropertyKey(),e.getParent()).then(t=>{this._getAdditionalColoringMeasuresForItem(t).forEach(t=>{const a=this._getState(e.getParent());if(a.aColMeasures?.indexOf(t)==-1){a.aColMeasures.push(t)}})})}})};_._getAdditionalColoringMeasuresForItem=function(e){let t=[];const a=e.datapoint?e.datapoint.criticality:null;if(a?.DynamicThresholds){t=a.DynamicThresholds.usedMeasures}return t};_._addCriticality=function(e){return this._getPropertyInfosByName(e.getPropertyKey(),e.getParent()).then(t=>{if(t.criticality||t.datapoint?.criticality){const a=this._getState(e.getParent()).oColorings||{Criticality:{DimensionValues:{},MeasureValues:{}}};const n={};if(e.getType()=="groupable"){const r=t.criticality||[];for(const e in r){n[e]={Values:r[e]}}const i=this.getInternalChartNameFromPropertyNameAndKind(e.getPropertyKey(),"groupable",e.getParent());a.Criticality.DimensionValues[i]=n}else{const r=t.datapoint&&t.datapoint.criticality?t.datapoint.criticality:[];for(const e in r){n[e]=r[e]}const i=this.getInternalChartNameFromPropertyNameAndKind(e.getPropertyKey(),"aggregatable",e.getParent());a.Criticality.MeasureValues[i]=n}const r=this._getState(e.getParent());r.oColorings=a;this._setState(e.getParent(),r)}})};_._updateColoring=function(e,t,a){const n=this._getChart(e);const r=this._getState(e);const i=jQuery.extend(true,{},r.oColorings);if(i&&i.Criticality){let e;for(let a=0;a<t.length;a++){const n=t[a];if(r.oColorings.Criticality.DimensionValues[n]){e={coloring:"Criticality",parameters:{dimension:n}};delete i.Criticality.MeasureValues;break}}if(!e){delete i.Criticality.DimensionValues;for(const e in i.Criticality.MeasureValues){if(a.indexOf(e)==-1){delete i.Criticality.MeasureValues[e]}}e={coloring:"Criticality",parameters:{measure:a}}}if(e){n.setColorings(i);n.setActiveColoring(e)}}};_._updateSemanticalPattern=function(e){const t=this._getChart(e).getVisibleMeasures();t.forEach(t=>{const a=this.getPropertyFromNameAndKind(t,"aggregatable",e);if(!a){return}const n=a.datapoint;if(n){if(n.targetValue||n.foreCastValue){const a=this._getChart(e).getMeasureByName(t);a.setSemantics("actual");if(n.targetValue!=null){const t=this._getChart(e).getMeasureByName(n.targetValue);if(t){t.setSemantics("reference")}else{r.error("sap.ui.mdc.Chart: "+n.targetValue+" is not a valid measure")}}if(n.foreCastValue){const t=this._getChart(e).getMeasureByName(n.foreCastValue);if(t){t.setSemantics("projected")}else{r.error("sap.ui.comp.SmartChart: "+n.ForecastValue.Path+" is not a valid measure")}}a.setSemanticallyRelatedMeasures({referenceValueMeasure:n.targetValue,projectedValueMeasure:n.foreCastValue})}}})};_.mMatchingIcon={bar:"sap-icon://horizontal-bar-chart",bullet:"sap-icon://horizontal-bullet-chart",bubble:"sap-icon://bubble-chart",column:"sap-icon://vertical-bar-chart",combination:"sap-icon://business-objects-experience",dual_bar:"sap-icon://horizontal-bar-chart",dual_column:"sap-icon://vertical-bar-chart",dual_combination:"sap-icon://business-objects-experience",dual_horizontal_combination:"sap-icon://business-objects-experience",dual_horizontal_stacked_combination:"sap-icon://business-objects-experience",dual_line:"sap-icon://line-chart",dual_stacked_bar:"sap-icon://full-stacked-chart",dual_stacked_column:"sap-icon://vertical-stacked-chart",dual_stacked_combination:"sap-icon://business-objects-experience",donut:"sap-icon://donut-chart",heatmap:"sap-icon://heatmap-chart",horizontal_stacked_combination:"sap-icon://business-objects-experience",line:"sap-icon://line-chart",pie:"sap-icon://pie-chart",scatter:"sap-icon://scatter-chart",stacked_bar:"sap-icon://full-stacked-chart",stacked_column:"sap-icon://vertical-stacked-chart",stacked_combination:"sap-icon://business-objects-experience",treemap:"sap-icon://Chart-Tree-Map",vertical_bullet:"sap-icon://vertical-bullet-chart","100_dual_stacked_bar":"sap-icon://full-stacked-chart","100_dual_stacked_column":"sap-icon://vertical-stacked-chart","100_stacked_bar":"sap-icon://full-stacked-chart","100_stacked_column":"sap-icon://full-stacked-column-chart",waterfall:"sap-icon://vertical-waterfall-chart",horizontal_waterfall:"sap-icon://horizontal-waterfall-chart"};_.getChartTypeInfo=function(e){const a=e.getChartType(),n=t.getResourceBundleFor("sap.ui.mdc"),r=t.getResourceBundleFor("sap.chart.messages");const i={icon:_.mMatchingIcon[a],text:n.getText("chart.CHART_TYPE_TOOLTIP",[r.getText("info/"+a)])};return i};_.getAvailableChartTypes=function(e){const a=[];if(this._getChart(e)){const n=this._getChart(e).getAvailableChartTypes().available;const r=t.getResourceBundleFor("sap.chart.messages");for(let e=0;e<n.length;e++){const t=n[e].chart;a.push({key:t,icon:_.mMatchingIcon[t],text:r.getText("info/"+t)})}}return a};_.getDrillStack=function(e){const t=Object.assign([],this._getChart(e).getDrillStack());t.forEach(t=>{t.dimension=t.dimension.map(t=>{const a=this.getPropertyFromNameAndKind(t,"groupable",e);if(a){return a.key}else{r.error("MDC Chart Delegate: Couldn't map chart dimension to groupable property: "+t);return t}})});return t};_.getSortedDimensions=function(e){return new Promise((t,a)=>{if(e.isPropertyHelperFinal()){t(this._sortPropertyDimensions(e.getPropertyHelper().getProperties()))}else{e.finalizePropertyHelper().then(()=>{t(this._sortPropertyDimensions(e.getPropertyHelper().getProperties()))})}})};_._sortPropertyDimensions=function(e){const t=e.filter(e=>e.groupable);if(t){t.sort((e,t)=>{if(e.label&&t.label){return e.label.localeCompare(t.label)}})}return t};_.getDrillableItems=function(e){const t=e.getItems().filter(e=>e.getType()==="groupable");return t};_.setChartType=function(e,t){this._getChart(e).setChartType(t)};_.createInnerChartContent=function(e,t){return new Promise((a,n)=>{this._setChart(e,new b({id:e.getId()+"--innerChart",chartType:"column",height:"100%",width:"100%",isAnalytical:true,vizProperties:{plotArea:{scrollbar:{forceToShowInMobile:true}}}}));this._getChart(e).setCustomMessages({NO_DATA:e.getNoDataText()});this._getState(e).inResultDimensions=[];this._getInnerStructure(e).removeStyleClass("sapUiMDCChartTempText");e.removeStyleClass("sapUiMDCChartTempTextOuter");e.addStyleClass("sapUiMDCChartGrid");const i=this._getState(e);i.aColMeasures=[];i.aInSettings=[];this._setState(e,i);this._createContentFromItems(e).then(()=>{this._getChart(e).attachRenderComplete(()=>{if(this._getState(e).toolbarUpdateRequested){e._updateToolbar();this._getState(e).toolbarUpdateRequested=false}});this._getInnerStructure(e).setContent(this._getChart(e));this._getInnerStructure(e).setShowNoDataStruct(false);i.dataLoadedCallback=t;this._setState(e,i);let n;if(this._getBindingInfo){n=this._getBindingInfo(e);r.warning("mdc ChartDelegate","calling the private delegate._getBindingInfo. Please make the function public!")}else{n=this.getBindingInfo(e)}this.updateBindingInfo(e,n);this._performInitialBind(e,n);a()})})};_._performInitialBind=function(e,t){if(e&&t&&this._getChart(e)){this._addBindingListener(t,"dataReceived",this._onDataLoadComplete.bind(e));this._getChart(e).bindData(t);this._setBindingInfoForState(e,t);const a=this._getState(e);a.innerChartBound=true;this._checkForMeasureWarning(e)}};_.requestToolbarUpdate=function(e){if(e.getItems().length===0){e._updateToolbar();return}this._getState(e).toolbarUpdateRequested=true};_.createInnerDimension=function(e,t){this._getPropertyInfosByName(t.getPropertyKey(),e).then(a=>{this._addInnerDimension(e,t,a)})};_.createInnerMeasure=function(e,t){this._getPropertyInfosByName(t.getPropertyKey(),e).then(a=>{this._addInnerMeasure(e,t,a)})};_._addInnerDimension=function(e,t,a){const n=this.innerDimensionFactory(e,t,a);this._getChart(e).addDimension(n);if(e._bDrillDown){this._getChart(e).drillDown(n);e._bDrillDown=false}};_.innerDimensionFactory=function(e,t,a){let n;const r=this.getInternalChartNameFromPropertyNameAndKind(t?.getPropertyKey()||a.key,"groupable",e);let i={name:r,role:t?.getRole()||a.role,label:t?.getLabel()||a.label,textFormatter:this.formatText.bind(a)};if(a.timeUnitType){i=y(i,{timeUnit:a.timeUnitType});n=new S(i)}else{n=new I(i)}if(a.textProperty){n.setTextProperty(a.textProperty);n.setDisplayText(true)}return n};_._addInnerMeasure=function(e,t,a){const n=this.innerMeasureFactory(e,t,a);this._getChart(e).addMeasure(n)};_.innerMeasureFactory=function(e,t,a){const{aggregationMethod:n,path:r}=a;const i={name:this._getAggregatedMeasureNameForMDCItem(t),label:t?.getLabel()||a.label,role:t?.getRole()||a.role||"axis1"};if(n&&r){i.analyticalInfo={propertyPath:r,with:n}}if(a.unitPath){i.unitBinding=a.unitPath}return new D(i)};_._getAggregatedMeasureNameForProperty=function(e){return e.aggregationMethod+e.key};_.rebind=function(e,t){if(e&&t&&this._getChart(e)){this._addBindingListener(t,"dataReceived",this._onDataLoadComplete.bind(e));this._getInnerStructure(e).setShowNoDataStruct(false);if(t.binding){t.binding.bHasAnalyticalInfo=true}this._getChart(e).bindData(t);this._setBindingInfoForState(e,t);const a=this._getState(e);a.innerChartBound=true}};_._checkForMeasureWarning=function(e){if(!e.getNoData()){return}const t=e.getItems().filter(e=>e.getType()==="aggregatable");if(t.length===0){this._getInnerStructure(e).setShowNoDataStruct(true);e.setBusy(false)}else{this._getInnerStructure(e).setShowNoDataStruct(false)}};_.getBindingInfo=function(e){if(this._getBindingInfoFromState(e)){return this._getBindingInfoFromState(e)}const t=e.getDelegate().payload;const a="/"+t.collectionName;const n={path:a};return n};_.getInnerChartBound=function(e){const t=this._getState(e);if(!t){return false}return t.innerChartBound?true:false};_.updateBindingInfo=function(e,t){k(e,t);t.filters=this.getFilters(e);t.sorter=this.getSorters(e)};function k(t,a){const n=e.getElementById(t.getFilter());if(!n){return}const r=n.getConditions();const i=n.getSearch instanceof Function?n.getSearch():"";if(r){const e=o.getParametersInfo(n,r);if(e){a.path=e}}if(!a.parameters){a.parameters={}}a.parameters["$search"]=i||undefined}_.getSorters=function(e){let t;const a=e.getSortConditions()?e.getSortConditions().sorters:[];a.forEach(a=>{const n=e.getItems().find(e=>e.getPropertyKey()===a.key);if(!n){return}const r=this._getSorterForItem(n,a);if(t){t.push(r)}else{t=[r]}});return t};_._getAggregatedMeasureNameForMDCItem=function(e){return this.getInternalChartNameFromPropertyNameAndKind(e.getPropertyKey(),"aggregatable",e.getParent())};_.getInternalChartNameFromPropertyNameAndKind=function(e,t,a){return e};_.getPropertyFromNameAndKind=function(e,t,a){return a.getPropertyHelper().getProperty(e)};_.setChartTooltipVisibility=function(e,t){if(this._getChart(e)){if(t){if(!this._getState(e).vizTooltip){const t=this._getState(e);t.vizTooltip=new P;this._setState(e,t)}this._getState(e).vizTooltip.connect(this._getChart(e).getVizUid())}else if(this._getState(e).vizTooltip){this._getState(e).vizTooltip.destroy()}}else{r.error("Trying to set chart tooltip while inner chart was not yet initialized")}};_._loadChart=function(){return new Promise(e=>{const a=["sap/chart/Chart","sap/chart/data/Dimension","sap/chart/data/TimeDimension","sap/chart/data/Measure","sap/viz/ui5/controls/VizTooltip"];function n(t,a,n,r,i){b=t;I=a;S=n;D=r;P=i;e()}t.load({name:"sap.viz"}).then(()=>{sap.ui.require(a,n)})})};_.getPropertyHelperClass=function(){return m};_.formatText=function(e,t){return e};_.setNoDataText=function(e,t){this._getChart(e).setCustomMessages({NO_DATA:t})};_.showOverlay=function(e,t){if(this._getInnerStructure(e)){this._getInnerStructure(e).showOverlay(t)}};_._getPropertyInfosByName=function(e,t){return t._getPropertyByNameAsync(e)};_._getModel=function(e){const t=e.getDelegate().payload;return e.getModel(t.model)};_._addBindingListener=function(e,t,a){if(!e.events){e.events={}}if(!e.events[t]){e.events[t]=a}else{const n=e.events[t];e.events[t]=function(){a.apply(this,arguments);n.apply(this,arguments)}}};_._onDataLoadComplete=function(e){const t=this.getControlDelegate()._getInnerStructure(this);if(this.getNoData()){if(e.getSource()&&e.getSource().getCurrentContexts().length===0){t.setShowNoDataStruct(true)}else{t.setShowNoDataStruct(false)}}this._innerChartDataLoadComplete(e);const a=this.getControlDelegate()._getChart(this);this._announceUpdate(this.getChartType(),this.getHeader(),a.getVisibleDimensions().length,a.getVisibleMeasures().length)};return _});
//# sourceMappingURL=ChartDelegate.js.map