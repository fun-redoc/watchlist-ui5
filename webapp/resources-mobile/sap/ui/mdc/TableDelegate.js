/*!
 * OpenUI5
 * (c) Copyright 2009-2024 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./AggregationBaseDelegate","sap/ui/mdc/mixin/delegate/FilterIntegrationDefault","sap/ui/mdc/enums/TableP13nMode","sap/ui/mdc/enums/TableType","sap/ui/mdc/enums/TableSelectionMode","sap/ui/mdc/util/loadModules","sap/m/plugins/PluginBase","sap/ui/model/Sorter","sap/ui/core/Lib","sap/ui/core/message/MessageType"],(e,t,n,r,o,i,l,s,a,u)=>{"use strict";const c=Object.assign({},e,t);c.updateBindingInfo=function(e,t){t.parameters={};t.sorter=[];if(e._oMessageFilter){t.filters=[e._oMessageFilter]}else{t.filters=this.getFilters(e)}const n=this.getGroupSorter(e);if(n){t.sorter.push(n)}const r=this.getSorters(e);t.sorter=t.sorter.concat(t.sorter.length===1?r.filter(e=>e.sPath!==t.sorter[0].sPath):r)};c.getGroupSorter=function(e){const t=e._getGroupedProperties()[0];if(!t||!e._isOfType(r.ResponsiveTable)){return undefined}const n=e._getSortedProperties().find(e=>e.name===t.name);const o=e.getPropertyHelper().getProperty(t.name).path;const i=n?n.descending:false;if(!e._mFormatGroupHeaderInfo||e._mFormatGroupHeaderInfo.propertyName!==t.name){e._mFormatGroupHeaderInfo={propertyName:t.name,formatter:function(n){return this.formatGroupHeader(e,n,t.name)}.bind(this)}}return new s(o,i,e._mFormatGroupHeaderInfo.formatter)};c.formatGroupHeader=function(e,t,n){const r=e.getPropertyHelper().getProperty(n);const o=r.textProperty;const i=a.getResourceBundleFor("sap.ui.mdc");let l="table.ROW_GROUP_TITLE";const s=[r.label,t.getProperty(r.path,true)];if(o){l="table.ROW_GROUP_TITLE_FULL";s.push(t.getProperty(o.path,true))}return i.getText(l,s)};c.getSorters=function(e){const t=e._getSortedProperties();const n=e.getPropertyHelper();const r=[];t.forEach(e=>{if(n.hasProperty(e.name)){const t=n.getProperty(e.name).path;r.push(new s(t,e.descending))}});return r};c.updateBinding=function(e,t,n,r){this.rebind(e,t)};c.rebind=function(e,t){e._getType().bindRows(t)};c.getFilterDelegate=function(){return{addItem:function(e,t){return Promise.resolve(null)},addCondition:function(e,t,n){return Promise.resolve()},removeCondition:function(e,t,n){return Promise.resolve()}}};c.fetchExportCapabilities=function(e){return Promise.resolve({XLSX:{}})};c.expandAllRows=function(e){throw Error("Unsupported operation: TableDelegate.expandAllRows")};c.collapseAllRows=function(e){throw Error("Unsupported operation: TableDelegate.collapseAllRows")};c.getSupportedFeatures=function(e){const t=[n.Column,n.Sort,n.Filter];if(e._isOfType(r.ResponsiveTable)){t.push(n.Group)}return{p13nModes:t,export:true,expandAllRows:false,collapseAllRows:false}};c.validateState=function(t,n,r){if(r=="Filter"&&t._oMessageFilter){const e=a.getResourceBundleFor("sap.ui.mdc");return{validation:u.Information,message:e.getText("table.PERSONALIZATION_DIALOG_FILTER_MESSAGESTRIP")}}return e.validateState.apply(this,arguments)};c.initializeContent=function(e){return this.initializeSelection(e)};c.initializeSelection=function(e){if(e._isOfType(r.Table,true)){return p(e)}else if(e._isOfType(r.ResponsiveTable)){return d(e)}else{return Promise.resolve()}};function p(e){const t={Single:"Single",SingleMaster:"Single",Multi:"MultiToggle"};return i("sap/ui/table/plugins/MultiSelectionPlugin").then(n=>{const r=n[0];if(e.isDestroyed()){return Promise.reject("Destroyed")}e._oTable.addDependent(new r({limit:"{$sap.ui.mdc.Table#type>/selectionLimit}",enableNotification:true,showHeaderSelector:"{$sap.ui.mdc.Table#type>/showHeaderSelector}",selectionMode:{path:"$sap.ui.mdc.Table>/selectionMode",formatter:function(e){return t[e]}},enabled:{path:"$sap.ui.mdc.Table>/selectionMode",formatter:function(e){return e in t}},selectionChange:function(t){e._onSelectionChange({selectAll:t.getParameter("selectAll")})}}))})}function d(e){const t={Single:"SingleSelectLeft",SingleMaster:"SingleSelectMaster",Multi:"MultiSelect"};const n={Default:"SelectAll",ClearAll:"ClearAll"};e._oTable.bindProperty("mode",{path:"$sap.ui.mdc.Table>/selectionMode",formatter:function(e){return t[e]}});e._oTable.bindProperty("multiSelectMode",{path:"$sap.ui.mdc.Table>/multiSelectMode",formatter:function(e){return n[e]||"SelectAll"}});e._oTable.attachSelectionChange(t=>{e._onSelectionChange({selectAll:t.getParameter("selectAll")})});return Promise.resolve()}c.setSelectedContexts=function(e,t){if(e._isOfType(r.ResponsiveTable)){const n=e.getSelectionMode();if(n===o.None||(n===o.Single||n===o.SingleMaster)&&t.length>1){throw Error("Unsupported operation: Cannot select the given number of contexts in the current selection mode")}const r=t.map(e=>e.getPath());e.clearSelection();e._oTable.setSelectedContextPaths(r);e._oTable.getItems().forEach(e=>{const t=e.getBindingContextPath();if(t&&r.indexOf(t)>-1){e.setSelected(true)}})}else{throw Error("Unsupported operation: Not supported for the current table type")}};c.getSelectedContexts=function(e){if(!e._oTable){return[]}if(e._isOfType(r.Table,true)){const t=l.getPlugin(e._oTable,"sap.ui.table.plugins.MultiSelectionPlugin");if(!t){return[]}return t.getSelectedIndices().map(t=>e._oTable.getContextByIndex(t),this)}if(e._isOfType(r.ResponsiveTable)){return e._oTable.getSelectedContexts(true)}return[]};c.clearSelection=function(e){if(!e._oTable){return}if(e._isOfType(r.Table,true)){const t=l.getPlugin(e._oTable,"sap.ui.table.plugins.SelectionPlugin");if(t){t.clearSelection()}}if(e._isOfType(r.ResponsiveTable)){e._oTable.removeSelections(true)}};return c});
//# sourceMappingURL=TableDelegate.js.map