/*!
 * OpenUI5
 * (c) Copyright 2009-2024 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./TableTypeBase","./utils/Personalization","sap/m/Button","sap/m/plugins/ColumnResizer","sap/m/SegmentedButton","sap/m/SegmentedButtonItem","sap/ui/Device","sap/ui/core/Element","sap/ui/core/Lib","sap/ui/mdc/enums/TableGrowingMode","sap/ui/mdc/enums/TableRowActionType"],(t,e,o,n,i,s,a,r,l,u,p)=>{"use strict";let h,c,d;const g=t.extend("sap.ui.mdc.table.ResponsiveTableType",{metadata:{library:"sap.ui.mdc",properties:{growingMode:{type:"sap.ui.mdc.enums.TableGrowingMode",group:"Behavior",defaultValue:u.Basic},showDetailsButton:{type:"boolean",group:"Behavior",defaultValue:false},detailsButtonSetting:{type:"sap.ui.core.Priority[]",group:"Behavior"},popinLayout:{type:"sap.m.PopinLayout",group:"Appearance",defaultValue:"Block"}}}});g.prototype.setDetailsButtonSetting=function(t){return this.setProperty("detailsButtonSetting",t,true)};g.prototype.setParent=function(){t.prototype.setParent.apply(this,arguments);this._oShowDetailsButton?.destroy();delete this._oShowDetailsButton;return this};g.prototype.updateTableByProperty=function(t,e){const o=this.getInnerTable();if(!o){return}if(t==="growingMode"){o.setGrowingScrollToLoad(e===u.Scroll);o.setGrowing(e!==u.None)}else if(t==="showDetailsButton"){this._updateShowDetailsButton(o,e)}else if(t==="popinLayout"){o.setPopinLayout(e)}};g.prototype._updateShowDetailsButton=function(t,e){if(e&&!this._oShowDetailsButton){t.getHeaderToolbar().insertEnd(this._getShowDetailsButton(),0);t.attachEvent("popinChanged",this._onPopinChanged,this);t.setHiddenInPopin(this._getImportanceToHide())}else if(!e&&this._oShowDetailsButton){t.detachEvent("popinChanged",this._onPopinChanged,this);t.getHeaderToolbar().removeEnd(this._oShowDetailsButton);t.setHiddenInPopin([]);this._oShowDetailsButton.destroy();delete this._oShowDetailsButton}};g.prototype.loadModules=function(){if(!h){return new Promise((t,e)=>{sap.ui.require(["sap/m/Table","sap/m/Column","sap/m/ColumnListItem"],(e,o,n)=>{h=e;c=o;d=n;t()},()=>{e("Failed to load some modules")})})}else{return Promise.resolve()}};g.prototype.createTable=function(t){const e=this.getTable();if(!e||!h){return null}return new h(t,this.getTableSettings())};g.prototype.getTableSettings=function(){const e=this.getTable();const o={autoPopinMode:true,contextualWidth:"Auto",growing:true,sticky:["ColumnHeaders","GroupHeaders","HeaderToolbar","InfoToolbar"],growingThreshold:{path:"$sap.ui.mdc.Table>/threshold",formatter:function(t){return t>-1?t:undefined}},noData:e._getNoDataText(),headerToolbar:e._oToolbar,ariaLabelledBy:[e._oTitle]};if(e.hasListeners("rowPress")){o.itemPress=[this._onItemPress,this]}return Object.assign({},t.prototype.getTableSettings.apply(this,arguments),o)};g.prototype._onItemPress=function(t){this.callHook("RowPress",this.getTable(),{bindingContext:t.getParameter("listItem").getBindingContext(this.getInnerTable().getBindingInfo("items").model)});this._onRowActionPress(t)};g.createColumn=function(t,e){return new c(t,e)};g.prototype.createRowTemplate=function(t){return new d(t,this.getRowSettingsConfig())};g.prototype.prepareRowPress=function(){if(this._attachItemPress()){this.updateRowActions()}};g.prototype.cleanupRowPress=function(){if(this._detachItemPress()){this.updateRowActions()}};g.prototype.updateRowSettings=function(){const t=this.getTable();if(!t||!t._oRowTemplate){return}t._oRowTemplate.unbindProperty("navigated");t._oRowTemplate.unbindProperty("highlight");t._oRowTemplate.unbindProperty("highlightText");t._oRowTemplate.applySettings(this.getRowSettingsConfig());this.updateRowActions()};g.prototype.updateRowActions=function(){const t=this.getTable();const e=this.getRowActionsConfig();const o=t.hasListeners("rowPress")?"Active":"Inactive";t._oRowTemplate.unbindProperty("type");if(!t.getRowSettings()){t._oRowTemplate.setType(o);return}if(o==="Inactive"){this._detachItemPress()}let n,i,s;if("templateInfo"in e){const t=e.templateInfo;s=t.visible.formatter;i=typeof t.visible=="object";n=t.visible}else if(e&&e.items){if(e.items.length==0){t._oRowTemplate.setType(o);return}const a=e.items.find(t=>t.getType()=="Navigation");if(!a&&e.items.length>0){throw new Error("No row action of type 'Navigation' found. ResponsiveTableType only accepts row actions of type 'Navigation'.")}t._oRowTemplate.data("rowAction",a);i=a.isBound("visible");n=i?Object.assign({},a.getBindingInfo("visible")):a.getVisible();s=n.formatter}if(i){n.formatter=t=>{const e=s?s(t):t;const n=e===true?p.Navigation:o;if(n===p.Navigation){this._attachItemPress()}return n};t._oRowTemplate.bindProperty("type",n)}else{n=n?p.Navigation:o;t._oRowTemplate.setProperty("type",n);if(n===p.Navigation){this._attachItemPress()}}};g.prototype.enableColumnResize=function(){const t=this.getTable();const e=this.getInnerTable();if(!t||!e){return}let o=n.findOn(e);e.setFixedLayout("Strict");if(!o){o=new n;e.addDependent(o);o.attachColumnResize(this._onColumnResize,this)}else{o.setEnabled(true);o.detachColumnResize(this._onColumnResize,this);o.attachColumnResize(this._onColumnResize,this)}};g.prototype.disableColumnResize=function(){const t=this.getTable();const e=this.getInnerTable();if(!t||!e){return}const o=n.findOn(e);if(o){o.setEnabled(false);o.detachColumnResize(this._onColumnResize,this)}};g.prototype._onColumnResize=function(t){const e=this.getTable();const o=this.getInnerTable();const n=t.getParameter("column");const i=t.getParameter("width");const s=o.indexOfColumn(n);const a=e.getColumns()[s];this.callHook("ColumnResize",e,{column:a,width:i})};g.prototype.createColumnResizeMenuItem=function(t,e){const o=n.findOn(this.getInnerTable());if(!o){return}if(e.isA("sap.m.table.columnmenu.Menu")){return o.getColumnResizeQuickAction(t.getInnerColumn(),e)}else{return o.getColumnResizeButton(t.getInnerColumn())}};g.prototype._attachItemPress=function(){const t=this.getInnerTable();if(t&&!t.hasListeners("itemPress")){t.attachEvent("itemPress",this._onItemPress,this);return true}return false};g.prototype._detachItemPress=function(){const t=this.getTable();const e=this.getInnerTable();if(!t.hasListeners("rowPress")&&e){e.detachEvent("itemPress",this._onItemPress,this);return true}return false};g.prototype._toggleShowDetails=function(t){if(!this._oShowDetailsButton||t===this.bHideDetails){return}const e=this.getInnerTable();this.bHideDetails=t;if(this.bHideDetails){e.setHiddenInPopin(this._getImportanceToHide());this._oShowDetailsButton.setSelectedKey("hideDetails")}else{e.setHiddenInPopin();this._oShowDetailsButton.setSelectedKey("showDetails")}};g.prototype._getShowDetailsButton=function(){if(!this._oShowDetailsButton){const t=l.getResourceBundleFor("sap.ui.mdc");const e=this.getTable().getId();this.bHideDetails=true;this._oShowDetailsButton=new i(e+"-showHideDetails",{visible:false,selectedKey:"hideDetails",items:[new s({id:e+"-showDetails",icon:"sap-icon://detail-more",key:"showDetails",tooltip:t.getText("table.SHOWDETAILS_TEXT"),press:[function(){this._toggleShowDetails(false)},this]}),new s({id:e+"-hideDetails",icon:"sap-icon://detail-less",key:"hideDetails",tooltip:t.getText("table.HIDEDETAILS_TEXT"),press:[function(){this._toggleShowDetails(true)},this]})]})}return this._oShowDetailsButton};g.prototype.getContextMenuParameters=function(t){const e=t.getParameter("listItem");const o=t.getParameter("column");const n=o?r.getElementById(o.getId().replace(/\-innerColumn$/,"")):undefined;return{bindingContext:e.getBindingContext(this.getInnerTable().getBindingInfo("items").model),column:n}};g.prototype._getImportanceToHide=function(){const t=this.getDetailsButtonSetting()||[];if(t.length>0){return t}else{return a.system.phone?["Low","Medium"]:["Low"]}};g.prototype._onPopinChanged=function(t){const e=t.getParameter("hasPopin");const o=t.getParameter("hiddenInPopin");const n=t.getSource().getVisibleItems().length;if(n&&(o.length||e&&!this.bHideDetails)){this._oShowDetailsButton.setVisible(true)}else{this._oShowDetailsButton.setVisible(false)}};g.prototype._onRowActionPress=function(t){const e=this.getTable();const o=t.getParameter("listItem");if(o.getType()!=="Navigation"){return}const n=e.getRowSettings();const i=n.getAllActions();if(n.isBound("rowActions")){const t=i.items.model;if(!this._oRowActionItem){this._oRowActionItem=i.items.template.clone()}this._oRowActionItem.setModel(e.getModel(t),t);n.addDependent(this._oRowActionItem)}else{this._oRowActionItem=o.data("rowAction")}this._oRowActionItem.setType("Navigation");this.callHook("Press",this._oRowActionItem,{bindingContext:o.getBindingContext(this.getInnerTable().getBindingInfo("items").model)})};g.prototype.removeToolbar=function(){const t=this.getInnerTable();if(t){t.setHeaderToolbar()}};g.prototype.scrollToIndex=function(t){const e=this.getInnerTable();if(e){return e.scrollToIndex(t)}else{return Promise.reject()}};g.prototype.getRowBinding=function(){const t=this.getInnerTable();return t?t.getBinding("items"):undefined};g.prototype.bindRows=function(t){const e=this.getInnerTable();if(e){e.bindItems(t)}};g.prototype.isTableBound=function(){const t=this.getInnerTable();if(t){return t.isBound("items")}else{return false}};g.prototype.insertFilterInfoBar=function(t,e){const o=this.getInnerTable();if(o){o.setInfoToolbar(t);if(!o.getAriaLabelledBy().includes(e)){o.addAriaLabelledBy(e)}}};g.prototype.updateSortIndicator=function(t,e){t.getInnerColumn().setSortIndicator(e)};g.prototype._onColumnInsert=function(t){const o=this.getTable();const n=this.getInnerTable();if(e.isUserPersonalizationActive(o)&&n.getHiddenInPopin()?.includes(t.getInnerColumn().getImportance())&&o.getColumns().pop()===t){this._toggleShowDetails(false)}};g.prototype.exit=function(){t.prototype.exit.apply(this,arguments);this._oShowDetailsButton?.destroy();delete this._oShowDetailsButton};return g});
//# sourceMappingURL=ResponsiveTableType.js.map