/*!
 * OpenUI5
 * (c) Copyright 2009-2024 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Element","sap/ui/base/Object","sap/ui/base/ManagedObject","sap/ui/base/ManagedObjectObserver","sap/m/IconTabFilter","sap/m/IconTabHeader","sap/m/library","sap/uxap/ObjectPageSection"],function(e,t,o,n,r,a,s,i){"use strict";var c=s.TabsOverflowMode;var u=s.IconTabHeaderMode;var g=t.extend("sap.uxap._helpers.AB",{constructor:function(e){this._oObjectPageLayout=e;this._oObserver=new n(this._proxyStateChanges.bind(this))},getInterface:function(){return this}});g._focusSection=function(e,t){var o=e.getDomRef();if(o){o.focus(t)}};g.prototype.getObjectPageLayout=function(){return this._oObjectPageLayout};g.prototype._getAnchorBar=function(){var e=this.getObjectPageLayout(),t=e.getAggregation("_anchorBar"),n=e.getUpperCaseAnchorBar();if(!t){t=new a({id:e.getId()+"-anchBar",tabsOverflowMode:c.StartAndEnd,backgroundDesign:o.escapeSettingsValue(e.getBackgroundDesignAnchorBar()),mode:u.Inline});t.attachSelect(function(t){var o=t.getParameter("key");this._moveFocusOnSection(o);e.onAnchorBarTabPress(o)}.bind(this));t.addEventDelegate({onAfterRendering:e._adjustTitlePositioning.bind(e)});if(n){t.addStyleClass("sapUxAPAnchorBarUpperCase")}this.getObjectPageLayout().setAggregation("_anchorBar",t,true)}return t};g.prototype._buildAnchorBar=function(){var e=this.getObjectPageLayout(),t=this._getAnchorBar(),n=e.getUpperCaseAnchorBar();this.resetControl();this._oObserver.disconnect();e._getVisibleSections().forEach(function(a){var s=t.getId()+"-"+a.getId()+"-anchor",i=new r(s,{text:o.escapeSettingsValue(a._getTitle()),key:a.getId(),iconColor:o.escapeSettingsValue(a.getAnchorBarButtonColor())}),c=a._getVisibleSubSections();this._setupCustomButtonForwarding(a,i,n);if(e.getShowAnchorBarPopover()){if(c.length>1){c.forEach(function(e){var n=t.getId()+"-"+e.getId()+"-anchor",a=new r(n,{text:o.escapeSettingsValue(e._getTitle()),key:e.getId()});i.addItem(a);this._setupCustomButtonForwarding(e,a)},this)}else if(c.length===1&&!a.getCustomAnchorBarButton()&&c[0]._getTitle()?.trim()){i.setText(c[0]._getTitle());this._setupCustomButtonForwarding(c[0],i,n)}}t.addItem(i)},this);e.setAggregation("_anchorBar",t)};g.prototype._setupCustomButtonForwarding=function(e,t,o){var n=e.getCustomAnchorBarButton();if(!n){return}t.setText(n.getText());t.setIcon(n.getIcon());this._oObserver.observe(n,{properties:true});this._getAnchorBar().attachSelect(function(e){this._forwardPressToCustomButton(e.getParameter("item"))},this)};g.prototype._forwardPressToCustomButton=function(t){var o=t.getKey(),n=e.getElementById(o),r=n?.getCustomAnchorBarButton();if(r){r.firePress()}};g.prototype.resetControl=function(){this._getAnchorBar().destroyItems()};g.prototype.selectAnchorForSection=function(e){var t=sap.ui.getCore().byId(e),o;if(!t){return}o=t.isA("sap.uxap.ObjectPageSubSection");if(o){e=t.getParent().getId()}this._getAnchorBar().setSelectedKey(e)};g.prototype._setAnchorButtonsTabFocusValues=function(e){var t=this._getAnchorBar().getItems(),o,n="0",r="-1",a="tabIndex";t.forEach(function(t){o=t.$();if(t.getKey()===e){o.attr(a,n)}else{o.attr(a,r)}})};g.prototype._moveFocusOnSection=function(t){var o=e.getElementById(t),n,r,a={preventScroll:true},s;if(!o){return}if(!o.isActive()){s={onAfterRendering:function(){o.removeEventDelegate(s);g._focusSection(o,a)}};o.addEventDelegate(s);return}n=i._getClosestSection(o);r=this._getAnchorBar().getItems().find(e=>e.getKey()===n.getId());if(document.activeElement!==r.getDomRef()){s={onfocusin:function(){r.removeEventDelegate(s);g._focusSection(o,a)}};r.addEventDelegate(s)}g._focusSection(o,a)};g.prototype._proxyStateChanges=function(e){var t=e.object,o=t.getParent(),n=this._findAnchorForSectionBase(o),r=e.name,a=e.current,s="set"+h(r);if(n){n[s].call(n,a)}};g.prototype._findAnchorForSectionBase=function(e){var t=e?.getId(),o=this._getAnchorBar(),n=o.getItems(),r,a=function(e){return e.some(function(e){if(e.getKey()===t){r=e;return true}return a(e.getItems())})};a(n);return r};function h(e){return e.substring(0,1).toUpperCase()+e.substring(1)}return g});
//# sourceMappingURL=ObjectPageLayoutABHelper.js.map